var Sn=Object.defineProperty,Dn=Object.defineProperties;var In=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var Vt=(e,t,n)=>t in e?Sn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))Bt.call(t,n)&&Vt(e,n,t[n]);if(ot)for(var n of ot(t))Lt.call(t,n)&&Vt(e,n,t[n]);return e},oe=(e,t)=>Dn(e,In(t));var lt=(e,t)=>{var n={};for(var a in e)Bt.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&ot)for(var a of ot(e))t.indexOf(a)<0&&Lt.call(e,a)&&(n[a]=e[a]);return n};var ve=(e,t,n)=>new Promise((a,l)=>{var i=h=>{try{m(n.next(h))}catch(x){l(x)}},c=h=>{try{m(n.throw(h))}catch(x){l(x)}},m=h=>h.done?a(h.value):Promise.resolve(h.value).then(i,c);m((n=n.apply(e,t)).next())});import Se,{useCallback as _,useEffect as Ve,useImperativeHandle as ur,useMemo as cr,useRef as Ne,useState as He}from"react";import{useMemo as En}from"react";var Nn=(e,t)=>{let n=t.map(({basis:l,minWidth:i,maxWidth:c})=>({basis:l,minWidth:i,maxWidth:c,size:l,violation:0,frozen:!1,factor:0})),a=n.reduce((l,i)=>l-i.size,e);a>0?t.forEach(({grow:l},i)=>{n[i].factor=l}):a<0&&t.forEach(({shrink:l},i)=>{n[i].factor=l});for(let l of n)l.factor===0&&(l.frozen=!0);for(;n.some(({frozen:l})=>!l);){let l=n.reduce((c,m)=>c+(m.frozen?0:m.factor),0),i=0;for(let c of n)c.frozen||(c.size+=a*c.factor/l,c.size<c.minWidth?c.violation=c.minWidth-c.size:c.maxWidth!==void 0&&c.size>c.maxWidth?c.violation=c.maxWidth-c.size:c.violation=0,c.size+=c.violation,i+=c.violation);if(i>0)for(let c of n)c.violation>0&&(c.frozen=!0);else if(i<0)for(let c of n)c.violation<0&&(c.frozen=!0);else break;a=n.reduce((c,m)=>c-m.size,e)}return n.map(({size:l})=>l)},Ot=(e,t)=>{let n=e.map(({basis:a,minWidth:l,maxWidth:i,grow:c,shrink:m})=>[a,l,i,c,m].join(",")).join("|");return En(()=>{if(t===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};let a=Nn(t,e),l=0,i=a.map((c,m)=>(l+=c,m===a.length-1?1/0:l));return{fullWidth:Math.abs(t-l)<.1,columnWidths:a,columnRights:i,totalWidth:l}},[t,n])};import{useResizeDetector as mr}from"react-resize-detector";import Re,{useMemo as Mn}from"react";var Pn=()=>Re.createElement(Re.Fragment,null),Rn=()=>!1,Ft=({rowData:e})=>e,An=()=>null,kn=({rowIndex:e})=>Re.createElement(Re.Fragment,null,e+1),mt=()=>!0,Vn=e=>e,Bn=e=>{if(typeof e=="number")return{basis:0,grow:e,shrink:1};if(e.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(e.trim()),shrink:1};if(e.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(e.trim()),grow:1,shrink:1};if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){let[t,n]=e.trim().split(" ");return{basis:0,grow:parseFloat(t),shrink:parseFloat(n)}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){let[t,n]=e.trim().split(" ");return{basis:parseFloat(n),grow:parseFloat(t),shrink:1}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){let[t,n,a]=e.trim().split(" ");return{basis:parseFloat(a),grow:parseFloat(t),shrink:parseFloat(n)}}return{basis:0,grow:1,shrink:1}},Gt=(e,t,n)=>Mn(()=>{var l,i,c,m,h,x,I,E,w,G;let a=[t===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>Re.createElement(Re.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:mt}:oe(j({},t),{basis:(l=t==null?void 0:t.basis)!=null?l:40,grow:(i=t==null?void 0:t.grow)!=null?i:0,shrink:(c=t==null?void 0:t.shrink)!=null?c:0,minWidth:(m=t==null?void 0:t.minWidth)!=null?m:0,title:(h=t==null?void 0:t.title)!=null?h:Re.createElement("div",{className:"dsg-corner-indicator"}),component:(x=t==null?void 0:t.component)!=null?x:kn,isCellEmpty:mt}),...e];return n&&a.push(oe(j({},n),{basis:(I=n==null?void 0:n.basis)!=null?I:40,grow:(E=n==null?void 0:n.grow)!=null?E:0,shrink:(w=n==null?void 0:n.shrink)!=null?w:0,minWidth:(G=n.minWidth)!=null?G:0,isCellEmpty:mt})),a.map(g=>{var $,J,Q,P,A,ce,L,fe,he,v,we,ye,H,z,f,N;let X=g.width!==void 0?Bn(g.width):{basis:void 0,grow:void 0,shrink:void 0};return oe(j({},g),{basis:(J=($=g.basis)!=null?$:X.basis)!=null?J:0,grow:(P=(Q=g.grow)!=null?Q:X.grow)!=null?P:1,shrink:(ce=(A=g.shrink)!=null?A:X.shrink)!=null?ce:1,minWidth:(L=g.minWidth)!=null?L:100,component:(fe=g.component)!=null?fe:Pn,disableKeys:(he=g.disableKeys)!=null?he:!1,disabled:(v=g.disabled)!=null?v:!1,keepFocus:(we=g.keepFocus)!=null?we:!1,deleteValue:(ye=g.deleteValue)!=null?ye:Ft,copyValue:(H=g.copyValue)!=null?H:An,pasteValue:(z=g.pasteValue)!=null?z:Ft,prePasteValues:(f=g.prePasteValues)!=null?f:Vn,isCellEmpty:(N=g.isCellEmpty)!=null?N:Rn})})},[t,n,e]);import{useEffect as Gn}from"react";import{throttle as Kn}from"throttle-debounce";import{useCallback as Ln,useState as On}from"react";import Fn from"fast-deep-equal";var je=e=>{let[t,n]=On(e),a=Ln(l=>{n(i=>{let c=typeof l=="function"?l(i):l;return Fn(c,i)?i:c})},[n]);return[t,a]};var Kt=(e,t,n)=>{let[a,l]=je({top:!0,right:!0,bottom:!0,left:!0});return Gn(()=>{let i=Kn(100,()=>{var m,h,x,I,E,w,G,g,X,$;l({top:((m=e.current)==null?void 0:m.scrollTop)===0,right:((x=(h=e.current)==null?void 0:h.scrollLeft)!=null?x:0)>=((E=(I=e.current)==null?void 0:I.scrollWidth)!=null?E:0)-(t!=null?t:0)-1,bottom:((G=(w=e.current)==null?void 0:w.scrollTop)!=null?G:0)>=((X=(g=e.current)==null?void 0:g.scrollHeight)!=null?X:0)-(n!=null?n:0)-1,left:(($=e.current)==null?void 0:$.scrollLeft)===0})}),c=e.current;return c==null||c.addEventListener("scroll",i),setTimeout(i,100),()=>{c==null||c.removeEventListener("scroll",i),i.cancel()}},[n,t,e,l]),a};import{useEffect as Wn}from"react";var pe=(e,t)=>{Wn(()=>(document.addEventListener(e,t),()=>{document.removeEventListener(e,t)}),[t,e])};import{useCallback as zn,useMemo as _n,useRef as Un}from"react";import{throttle as jn}from"throttle-debounce";var dt=(e,t=200)=>{let n=Un(null),a=_n(()=>jn(t,!0,()=>{setTimeout(()=>{var l;return n.current=((l=e.current)==null?void 0:l.getBoundingClientRect())||null},0)}),[e,t]);return zn((l=!1)=>{var i;return l?n.current=((i=e.current)==null?void 0:i.getBoundingClientRect())||null:a(),n.current},[e,a])};import pt,{useState as Wt}from"react";var zt=(e={})=>({addRows:t})=>{var c,m;let[n,a]=Wt(1),[l,i]=Wt(String(n));return pt.createElement("div",{className:"dsg-add-row"},pt.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>t(n)},(c=e.button)!=null?c:"Add")," ",pt.createElement("input",{className:"dsg-add-row-input",value:l,onBlur:()=>i(String(n)),type:"number",min:1,onChange:h=>{i(h.target.value),a(Math.max(1,Math.round(parseInt(h.target.value)||0)))},onKeyDown:h=>{h.key==="Enter"&&t(n)}})," ",(m=e.unit)!=null?m:"rows")},ft=zt();ft.displayName="AddRows";import{useEffect as Xn,useMemo as Yn,useRef as $n,useState as vn}from"react";import{debounce as qn}from"throttle-debounce";var _t=(e,t)=>{let[n,a]=vn(e),l=$n();Xn(()=>()=>{var c;return(c=l.current)==null?void 0:c.cancel()},[]);let i=Yn(()=>l.current=qn(t,c=>{a(c)}),[t]);return[n,i]};import dr from"fast-deep-equal";import*as F from"react";import{useCallback as Jn,useRef as Hn}from"react";var ht=e=>e.type==="CUT"?F.createElement(F.Fragment,null,"Cut"):e.type==="COPY"?F.createElement(F.Fragment,null,"Copy"):e.type==="PASTE"?F.createElement(F.Fragment,null,"Paste"):e.type==="DELETE_ROW"?F.createElement(F.Fragment,null,"Delete row"):e.type==="DELETE_ROWS"?F.createElement(F.Fragment,null,"Delete rows ",F.createElement("b",null,e.fromRow)," to ",F.createElement("b",null,e.toRow)):e.type==="INSERT_ROW_BELLOW"?F.createElement(F.Fragment,null,"Insert row below"):e.type==="DUPLICATE_ROW"?F.createElement(F.Fragment,null,"Duplicate row"):e.type==="DUPLICATE_ROWS"?F.createElement(F.Fragment,null,"Duplicate rows ",F.createElement("b",null,e.fromRow)," to ",F.createElement("b",null,e.toRow)):e.type,Ut=(e=ht)=>({clientX:t,clientY:n,items:a,close:l})=>{let i=Hn(null),c=Jn(m=>{var x;(x=i.current)!=null&&x.contains(m.target)||l()},[l]);return pe("mousedown",c),F.createElement("div",{className:"dsg-context-menu",style:{left:t+"px",top:n+"px"},ref:i},a.map(m=>F.createElement("div",{key:m.type,onClick:m.action,className:"dsg-context-menu-item"},e(m))))},xt=Ut(ht);xt.displayName="ContextMenu";var Zn=typeof DOMParser!="undefined"?new DOMParser:{parseFromString:()=>null},jt=e=>Zn.parseFromString(e,"text/html");var st=e=>{var l,i;let t=jt(e.replace(/<br\/?>/g,`
`)),n=t.getElementsByTagName("table")[0];if(n){let c=[];for(let m=0;m<n.rows.length;m++){let h=[];c.push(h);for(let x=0;x<n.rows[m].cells.length;x++)h.push((l=n.rows[m].cells[x].textContent)!=null?l:"")}return c}let a=t.getElementsByTagName("span")[0];return a?[[(i=a.textContent)!=null?i:""]]:[[""]]},qe=e=>{let t=e.replace(/\r|\n$/g,""),n=[[]],a=0,l=0,i=!1,c=0,m=()=>{let h=t.slice(l,a);h[0]==='"'&&h[h.length-1]==='"'&&(i=!0),i&&h[h.length-1]==='"'&&h.includes(`
`)&&(h=h.slice(1,h.length-1).replace(/""/g,'"'),i=!1),i&&h[h.length-1]!=='"'?h.split(`
`).forEach((x,I,{length:E})=>{n[c].push(x),I<E-1&&(n.push([]),c++)}):n[c].push(h)};for(;a<t.length;)i&&t[a]==='"'&&![void 0,"	",'"'].includes(t[a+1])&&(i=!1),i&&t[a]==='"'&&t[a+1]==='"'&&a++,a===l&&t[a]==='"'&&(i=!0),t[a]==="	"&&(m(),l=a+1,i=!1),t[a]===`
`&&!i&&(m(),n.push([]),l=a+1,c++),a++;return m(),n},Xt=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),Yt=e=>e.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;var at=(e,t,n,a)=>{if(e===null||!t||!n)return null;if(typeof e!="object")throw new Error("Value must be an object or null");let l=a.findIndex(c=>c.id===e.col),i={col:Math.max(0,Math.min(t-1,l===-1?Number(e.col):l-1)),row:Math.max(0,Math.min(n-1,Number(e.row)))};if(isNaN(i.col)||isNaN(i.row))throw new Error("col or cell are not valid positive numbers");return i},Ae=(e,t)=>{var n;return e?{col:e.col,row:e.row,colId:(n=t[e.col+1])==null?void 0:n.id}:null},$t=(e,t,n,a)=>{if(e===null||!t||!n)return null;if(typeof e!="object")throw new Error("Value must be an object or null");let l={min:at(e.min,t,n,a),max:at(e.max,t,n,a)};if(!l.min||!l.max)throw new Error("min and max must be defined");return l},wt=(e,t)=>e?{min:Ae(e.min,t),max:Ae(e.max,t)}:null;var yt=()=>Array.from(document.querySelectorAll("*")).filter(e=>e instanceof HTMLElement&&typeof e.tabIndex=="number"&&e.tabIndex>=0&&!e.disabled&&(!(e instanceof HTMLAnchorElement)||!!e.href||e.getAttribute("tabIndex")!==null)&&getComputedStyle(e).visibility!=="collapse");import{defaultRangeExtractor as nr,useVirtualizer as vt}from"@tanstack/react-virtual";import Ee,{useEffect as rr}from"react";import it from"classnames";import Qn from"react";import er from"classnames";var gt=({children:e,gutter:t,stickyRight:n,active:a,disabled:l,className:i,width:c,left:m})=>Qn.createElement("div",{className:er("dsg-cell",t&&"dsg-cell-gutter",l&&"dsg-cell-disabled",t&&a&&"dsg-cell-gutter-active",n&&"dsg-cell-sticky-right",i),style:{width:c,left:n?void 0:m}},e);import{useMemo as tr}from"react";var Je=(e,t)=>tr(()=>{let n=new Map;return a=>(n.has(a)||n.set(a,(...l)=>{e(a,...l.slice(0,t))}),n.get(a))},[t,e]);var qt=({data:e,columns:t,outerRef:n,innerRef:a,columnWidths:l,hasStickyRightColumn:i,displayHeight:c,headerRowHeight:m,rowHeight:h,rowKey:x,fullWidth:I,selection:E,activeCell:w,rowClassName:G,cellClassName:g,children:X,editing:$,getContextMenuItems:J,setRowData:Q,deleteRows:P,duplicateRows:A,insertRowAfter:ce,stopEditing:L,onScroll:fe})=>{var Be,Le,et,tt;let he=vt({count:e.length,getScrollElement:()=>n.current,paddingStart:m,estimateSize:y=>h(y).height,getItemKey:y=>{if(x&&y>0){let K=e[y-1];if(typeof x=="function")return x({rowData:K,rowIndex:y});if(typeof x=="string"&&K instanceof Object&&x in K){let W=K[x];if(typeof W=="string"||typeof W=="number")return W}}return y},overscan:5}),v=vt({count:t.length,getScrollElement:()=>n.current,estimateSize:y=>{var K;return(K=l==null?void 0:l[y])!=null?K:100},horizontal:!0,getItemKey:y=>{var K;return(K=t[y].id)!=null?K:y},overscan:1,rangeExtractor:y=>{let K=nr(y);return K[0]!==0&&K.unshift(0),i&&K[K.length-1]!==t.length-1&&K.push(t.length-1),K}});rr(()=>{v.measure()},[v,l]);let we=Je(Q,1),ye=Je(P,0),H=Je(A,0),z=Je(ce,0),f=(Be=E==null?void 0:E.min.col)!=null?Be:w==null?void 0:w.col,N=(Le=E==null?void 0:E.max.col)!=null?Le:w==null?void 0:w.col,De=(et=E==null?void 0:E.min.row)!=null?et:w==null?void 0:w.row,q=(tt=E==null?void 0:E.max.row)!=null?tt:w==null?void 0:w.row;return Ee.createElement("div",{ref:n,className:"dsg-container",onScroll:fe,style:{height:c}},Ee.createElement("div",{ref:a,style:{width:I?"100%":v.getTotalSize(),height:he.getTotalSize()}},m>0&&Ee.createElement("div",{className:it("dsg-row","dsg-row-header"),style:{width:I?"100%":v.getTotalSize(),height:m}},v.getVirtualItems().map(y=>Ee.createElement(gt,{key:y.key,gutter:y.index===0,stickyRight:i&&y.index===t.length-1,width:y.size,left:y.start,className:it("dsg-cell-header",f!==void 0&&N!==void 0&&f<=y.index-1&&N>=y.index-1&&"dsg-cell-header-active",t[y.index].headerClassName)},Ee.createElement("div",{className:"dsg-cell-header-container"},t[y.index].title)))),he.getVirtualItems().map(y=>{let K=y.index>=(De!=null?De:1/0)&&y.index<=(q!=null?q:-1/0);return Ee.createElement("div",{key:y.key,className:it("dsg-row",typeof G=="string"?G:null,typeof G=="function"?G({rowData:e[y.index],rowIndex:y.index}):null),style:{height:y.size,top:y.start,width:I?"100%":v.getTotalSize()}},v.getVirtualItems().map(W=>{let Oe=t[W.index].cellClassName,xe=t[W.index].disabled,ge=t[W.index].component,nt=xe===!0||typeof xe=="function"&&xe({rowData:e[y.index],rowIndex:y.index}),Xe=(w==null?void 0:w.row)===y.index&&w.col===W.index-1;return Ee.createElement(gt,{key:W.key,gutter:W.index===0,stickyRight:i&&W.index===t.length-1,active:W.index===0&&K,disabled:nt,className:it(typeof Oe=="function"?Oe({rowData:e[y.index],rowIndex:y.index,columnId:t[W.index].id}):Oe,typeof g=="function"?g({rowData:e[y.index],rowIndex:y.index,columnId:t[W.index].id}):g),width:W.size,left:W.start},Ee.createElement(ge,{rowData:e[y.index],getContextMenuItems:J,disabled:nt,active:Xe,columnIndex:W.index-1,rowIndex:y.index,focus:Xe&&$,deleteRow:ye(y.index),duplicateRow:H(y.index),stopEditing:L,insertRowBelow:z(y.index),setRowData:we(y.index),columnData:t[W.index].columnData}))}))}),X))};import le,{useMemo as or}from"react";import ke from"classnames";var Jt=(e,t,n,a)=>[[a,e],[t,e],[t,n],[a,n],[a,e]],lr=(e,t,n,a)=>`polygon(evenodd, ${[...Jt(0,"100%","100%",0),...Jt(e,t,n,a)].map(i=>i.map(c=>typeof c=="number"&&c!==0?c+"px":c).join(" ")).join(",")})`,bt=le.memo(({columnWidths:e,columnRights:t,headerRowHeight:n,selection:a,rowHeight:l,activeCell:i,hasStickyRightColumn:c,dataLength:m,viewWidth:h,viewHeight:x,contentWidth:I,edges:E,isCellDisabled:w,editing:G,expandSelection:g})=>{var v,we,ye,H;let X=i?w(i):!1,$=or(()=>{if(!a)return X;for(let z=a.min.col;z<=a.max.col;++z)for(let f=a.min.row;f<=a.max.row;++f)if(!w({col:z,row:f}))return!1;return!0},[X,w,a]);if(!e||!t)return null;let J=z=>z<m-1?1:0,Q=z=>z<e.length-(c?3:2)?1:0,P=i&&{width:e[i.col+1]+Q(i.col),height:l(i.row).height+J(i.row),left:t[i.col],top:l(i.row).top+n},A=a&&{width:e.slice(a.min.col+1,a.max.col+2).reduce((z,f)=>z+f)+Q(a.max.col),height:l(a.max.row).top+l(a.max.row).height-l(a.min.row).top+J(a.max.row),left:t[a.min.col],top:l(a.min.row).top+n},ce=(a==null?void 0:a.min)||i,L=(a==null?void 0:a.max)||i,fe=L&&g!==null&&{left:t[L.col]+e[L.col+1],top:l(L.row).top+l(L.row).height+n,transform:`translate(-${L.col<e.length-(c?3:2)?50:100}%, -${L.row<m-1?50:100}%)`},he=ce&&L&&g!==null&&{width:e.slice(ce.col+1,L.col+2).reduce((z,f)=>z+f)+Q(L.col),height:l(L.row+g).top+l(L.row+g).height-l(L.row+1).top+J(L.row+g)-1,left:t[ce.col],top:l(L.row).top+l(L.row).height+n+1};return le.createElement(le.Fragment,null,le.createElement("div",{className:"dsg-scrollable-view-container",style:{height:l(m-1).top+l(m-1).height+n,width:I||"100%"}},le.createElement("div",{className:ke({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!E.top,"dsg-scrollable-view-r":!E.right,"dsg-scrollable-view-b":!E.bottom,"dsg-scrollable-view-l":!E.left}),style:{top:n,left:e[0],height:x?x-n:0,width:I&&h?h-e[0]-(c?e[e.length-1]:0):`calc(100% - ${e[0]+(c?e[e.length-1]:0)}px)`}})),(A||P)&&le.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(v=A==null?void 0:A.left)!=null?v:P==null?void 0:P.left,width:(we=A==null?void 0:A.width)!=null?we:P==null?void 0:P.width,height:l(m-1).top+l(m-1).height+n}},le.createElement("div",{className:ke("dsg-selection-col-marker",$&&"dsg-selection-col-marker-disabled"),style:{top:n}})),(A||P)&&le.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(ye=A==null?void 0:A.top)!=null?ye:P==null?void 0:P.top,height:(H=A==null?void 0:A.height)!=null?H:P==null?void 0:P.height,width:I||"100%"}},le.createElement("div",{className:ke("dsg-selection-row-marker",$&&"dsg-selection-row-marker-disabled"),style:{left:e[0]}})),P&&i&&le.createElement("div",{className:ke("dsg-active-cell",{"dsg-active-cell-focus":G,"dsg-active-cell-disabled":X}),style:P}),A&&P&&le.createElement("div",{className:ke("dsg-selection-rect",$&&"dsg-selection-rect-disabled"),style:oe(j({},A),{clipPath:lr(P.top-A.top,P.left-A.left,P.top+P.height-A.top,P.left+P.width-A.left)})}),he&&le.createElement("div",{className:ke("dsg-expand-rows-rect"),style:he}),fe&&le.createElement("div",{className:ke("dsg-expand-rows-indicator",$&&"dsg-expand-rows-indicator-disabled"),style:fe}))});bt.displayName="SelectionRect";import{useMemo as sr,useRef as ar,useState as ir}from"react";var Ht=({value:e,rowHeight:t})=>{let n=ar([]),[,a]=ir(0);return sr(()=>{let l=i=>{if(typeof t=="number")return Math.min(e.length-1,Math.max(-1,Math.floor(i/t)));let c=0,m=n.current.length-1;for(;c<=m;){let h=Math.floor((c+m)/2);if(n.current[h].top<i)c=h+1;else if(n.current[h].top>i)m=h-1;else return h}if(m===n.current.length-1&&e.length>n.current.length&&(!n.current.length||i>=n.current[m].top+n.current[m].height)){let h=m===-1?0:n.current[m].top+n.current[m].height;do{m++;let x=t({rowIndex:m,rowData:e[m]});n.current.push({height:x,top:h}),h+=x}while(h<=i&&m<n.current.length-1)}return m};return{resetAfter:i=>{n.current=n.current.slice(0,i),a(c=>c+1)},getRowSize:i=>{if(typeof t=="number")return{height:t,top:t*i};if(i>=e.length)return{height:0,top:0};if(i<n.current.length)return n.current[i];let c=n.current[n.current.length-1].top+n.current[n.current.length-1].height;for(let m=n.current.length;m<=i;m++){let h=t({rowIndex:m,rowData:e[m]});n.current.push({height:h,top:c}),c+=h}return n.current[i]},getRowIndex:l,totalSize:i=>{if(typeof t=="number")return e.length*t;let c=l(i);return n.current[c].top+n.current[c].height}}},[t,e])};var pr=[],fr=[],hr=()=>({}),Ze=()=>null,xr=({rowData:e})=>j({},e),Qe=Se.memo(Se.forwardRef(({value:e=pr,className:t,style:n,height:a=400,onChange:l=Ze,columns:i=fr,rowHeight:c=40,headerRowHeight:m=typeof c=="number"?c:40,gutterColumn:h,stickyRightColumn:x,rowKey:I,addRowsComponent:E=ft,createRow:w=hr,autoAddRow:G=!1,lockRows:g=!1,disableExpandSelection:X=!1,disableSmartDelete:$=!1,duplicateRow:J=xr,contextMenuComponent:Q=xt,disableContextMenu:P=!1,onFocus:A=Ze,onBlur:ce=Ze,onActiveCellChange:L=Ze,onSelectionChange:fe=Ze,rowClassName:he,cellClassName:v,onScroll:we},ye)=>{var Nt,Mt,Pt,Rt,At,kt;let H=Ne(null),z=P||g,f=Gt(i,h,x),N=!!x,De=Ne(null),q=Ne(null),Be=Ne(null),Le=Ne(null),[et,tt]=_t(1,100),{getRowSize:y,totalSize:K,getRowIndex:W}=Ht({value:e,rowHeight:c}),Oe=Math.min(a,m+K(a)+et),{width:xe,height:ge}=mr({targetRef:q,refreshMode:"throttle",refreshRate:100});tt(ge?Oe-ge:0);let nt=Kt(q,xe,ge),{fullWidth:Xe,totalWidth:mn,columnWidths:se,columnRights:me}=Ot(f,xe),[Fe,ae]=He(null),[Ge,dn]=He([]),[k,U]=He(!1),[Ke,Tt]=He(0),[We,St]=He(null),[o,R]=je(null),[Y,M]=je(null),s=cr(()=>o&&Y&&{min:{col:Math.min(o.col,Y.col),row:Math.min(o.row,Y.row)},max:{col:Math.max(o.col,Y.col),row:Math.max(o.row,Y.row)}},[o,Y]),[be,ze]=je({columns:!1,rows:!1,active:!1}),pn=X||k||be.active||(o==null?void 0:o.row)===(e==null?void 0:e.length)-1||(s==null?void 0:s.max.row)===(e==null?void 0:e.length)-1||o&&f.slice(((Nt=s==null?void 0:s.min.col)!=null?Nt:o.col)+1,((Mt=s==null?void 0:s.max.col)!=null?Mt:o.col)+2).every(r=>r.disabled===!0)?null:Ke,Dt=dt(De),It=dt(q);Ve(()=>{var r;o!==null&&(document.activeElement.blur(),(r=window.getSelection())==null||r.removeAllRanges())},[o!==null]);let Pe=_((r,d=!1,p=!1)=>{let u=Dt(d),b=p&&It(d);if(u&&me&&se){let D=r.clientX-u.left,S=r.clientY-u.top;return b&&(r.clientY-b.top<=m&&(S=0),r.clientX-b.left<=se[0]&&(D=0),N&&b.right-r.clientX<=se[se.length-1]&&(D=me[me.length-2]+1)),{col:me.findIndex(T=>D<T)-1,row:W(S-m)}}return null},[me,se,e.length,Dt,It,m,N,W]),ee=Ne(e);ee.current=e;let te=_(r=>{let d=f[r.col+1].disabled;return!!(typeof d=="function"?d({rowData:ee.current[r.row],rowIndex:r.row}):d)},[f]),Ce=_((r,d=1)=>{g||(M(null),U(!1),l([...ee.current.slice(0,r+1),...new Array(d).fill(0).map(w),...ee.current.slice(r+1)],[{type:"CREATE",fromRowIndex:r+1,toRowIndex:r+1+d}]),R(p=>({col:(p==null?void 0:p.col)||0,row:r+d,doNotScrollX:!0})))},[w,g,l,R,M]),_e=_((r,d=r)=>{g||(l([...ee.current.slice(0,d+1),...ee.current.slice(r,d+1).map((p,u)=>J({rowData:p,rowIndex:u+r})),...ee.current.slice(d+1)],[{type:"CREATE",fromRowIndex:d+1,toRowIndex:d+2+d-r}]),R({col:0,row:d+1,doNotScrollX:!0}),M({col:f.length-(N?3:2),row:2*d-r+1,doNotScrollX:!0}),U(!1))},[f.length,J,g,l,R,M,N]),Te=_(r=>{if(!(!ge||!xe)){if(!r.doNotScrollY){let d=y(r.row).top,p=y(r.row).top+y(r.row).height+m-ge+1,u=q.current.scrollTop;u>d?q.current.scrollTop=d:u<p&&(q.current.scrollTop=p)}if(me&&se&&q.current&&!r.doNotScrollX){let d=me[r.col]-me[0],p=me[r.col]+se[r.col+1]+(N?se[se.length-1]:0)-xe+1,u=q.current.scrollLeft;u>d?q.current.scrollLeft=d:u<p&&(q.current.scrollLeft=p)}}},[ge,xe,m,me,se,y,N]);Ve(()=>{Y&&Te(Y)},[Y,Te]),Ve(()=>{o&&Te(o)},[o,Te]);let fn=_((r,d)=>{var p,u;l([...(p=ee.current)==null?void 0:p.slice(0,r),d,...(u=ee.current)==null?void 0:u.slice(r+1)],[{type:"UPDATE",fromRowIndex:r,toRowIndex:r+1}])},[l]),Ue=_((r,d=r)=>{g||(U(!1),R(p=>{let u=Math.min(ee.current.length-2-d+r,r);return u<0?null:p&&{col:p.col,row:u}}),M(null),l([...ee.current.slice(0,r),...ee.current.slice(d+1)],[{type:"DELETE",fromRowIndex:r,toRowIndex:d+1}]))},[g,l,R,M]),rt=_((r=!0)=>{let d=r&&!$;if(!o)return;let p=(s==null?void 0:s.min)||o,u=(s==null?void 0:s.max)||o;if(e.slice(p.row,u.row+1).every((D,S)=>f.every(T=>T.isCellEmpty({rowData:D,rowIndex:S+p.row})))){d&&Ue(p.row,u.row);return}let b=[...e];for(let D=p.row;D<=u.row;++D)for(let S=p.col;S<=u.col;++S)if(!te({col:S,row:D})){let{deleteValue:T=({rowData:O})=>O}=f[S+1];b[D]=T({rowData:b[D],rowIndex:D})}if(d&&dr(b,e)){R({col:0,row:p.row,doNotScrollX:!0}),M({col:f.length-(N?3:2),row:u.row,doNotScrollX:!0});return}l(b,[{type:"UPDATE",fromRowIndex:p.row,toRowIndex:u.row+1}])},[o,f,e,Ue,te,l,s==null?void 0:s.max,s==null?void 0:s.min,R,M,N]),ut=_(({nextRow:r=!0}={})=>{(o==null?void 0:o.row)===ee.current.length-1?r&&G?Ce(o.row):U(!1):(U(!1),r&&R(d=>d&&{col:d.col,row:d.row+1}))},[o==null?void 0:o.row,G,Ce,R]),Ye=_(r=>ve(null,null,function*(){var d,p;if(!k&&o){let u=[],b=(s==null?void 0:s.min)||o,D=(s==null?void 0:s.max)||o;for(let C=b.row;C<=D.row;++C){u.push([]);for(let V=b.col;V<=D.col;++V){let{copyValue:B=()=>null}=f[V+1];u[C-b.row].push(B({rowData:e[C],rowIndex:C}))}}let S=u.map(C=>C.join("	")).join(`
`),T=`<table>${u.map(C=>`<tr>${C.map(V=>`<td>${Xt(String(V!=null?V:"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(r!==void 0){(d=r.clipboardData)==null||d.setData("text/plain",S),(p=r.clipboardData)==null||p.setData("text/html",T),r.preventDefault();return}let O=!1;if(navigator.clipboard.write!==void 0){let C=new Blob([S],{type:"text/plain"}),V=new Blob([T],{type:"text/html"}),B=[new ClipboardItem({"text/plain":C,"text/html":V})];yield navigator.clipboard.write(B).then(()=>{O=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(S).then(()=>{O=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(O=!0);O||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[o,f,e,k,s]);pe("copy",Ye);let ct=_(r=>{!k&&o&&(Ye(r),rt(!1))},[o,rt,k,Ye]);pe("cut",ct);let $e=_(r=>ve(null,null,function*(){var d,p;if(!k&&o){let u=(s==null?void 0:s.min)||o,b=(s==null?void 0:s.max)||o,D=yield Promise.all(r[0].map((S,T)=>{var V,B;let O=(V=f[u.col+T+1])==null?void 0:V.prePasteValues,C=r.map(ne=>ne[T]);return(B=O==null?void 0:O(C))!=null?B:C}));if(r=r.map((S,T)=>D.map(O=>O[T])),r.length===1){let S=[...e];for(let T=0;T<r[0].length;T++){let O=(d=f[u.col+T+1])==null?void 0:d.pasteValue;if(O)for(let C=u.row;C<=b.row;C++)te({col:T+u.col,row:C})||(S[C]=yield O({rowData:S[C],value:r[0][T],rowIndex:C}))}l(S,[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:b.row+1}]),R({col:u.col,row:u.row}),M({col:Math.min(u.col+r[0].length-1,f.length-(N?3:2)),row:b.row})}else{let S=[...e],T=u.row+r.length-e.length;T>0&&(g?r.splice(r.length-T,T):S=[...S,...new Array(T).fill(0).map(()=>w())]);for(let C=0;C<r[0].length&&u.col+C<f.length-(N?2:1);C++){let V=(p=f[u.col+C+1])==null?void 0:p.pasteValue;if(V)for(let B=0;B<r.length;B++)te({col:u.col+C,row:u.row+B})||(S[u.row+B]=yield V({rowData:S[u.row+B],value:r[B][C],rowIndex:u.row+B}))}let O=[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:u.row+r.length-(!g&&T>0?T:0)}];T>0&&!g&&O.push({type:"CREATE",fromRowIndex:u.row+r.length-T,toRowIndex:u.row+r.length}),l(S,O),R({col:u.col,row:u.row}),M({col:Math.min(u.col+r[0].length-1,f.length-(N?3:2)),row:u.row+r.length-1})}}}),[o,f,w,e,k,N,te,g,l,s==null?void 0:s.max,s==null?void 0:s.min,R,M]),hn=_(r=>{var d,p,u,b,D,S;if(o&&!k){let T=[[""]];(d=r.clipboardData)!=null&&d.types.includes("text/html")?T=st((p=r.clipboardData)==null?void 0:p.getData("text/html")):(u=r.clipboardData)!=null&&u.types.includes("text/plain")?T=qe((b=r.clipboardData)==null?void 0:b.getData("text/plain")):(D=r.clipboardData)!=null&&D.types.includes("text")&&(T=qe((S=r.clipboardData)==null?void 0:S.getData("text"))),$e(T),r.preventDefault()}},[o,$e,k]);pe("paste",hn);let xn=_(r=>{var V,B,ne;if(Fe&&Ge.length)return;let d=r.button===2||r.button===0&&r.ctrlKey,p=((V=De.current)==null?void 0:V.contains(r.target))||!1,u=p?Pe(r,!0,!0):null;if(!p&&k&&o&&f[o.col+1].keepFocus)return;if(r.target instanceof HTMLElement&&r.target.className.includes("dsg-expand-rows-indicator")){St(Math.max((B=o==null?void 0:o.row)!=null?B:0,(ne=s==null?void 0:s.max.row)!=null?ne:0));return}let b=u&&o&&o.col===u.col&&o.row===u.row&&!te(o);if(b&&k)return;let D=(u==null?void 0:u.col)===f.length-2&&N,S=d&&s&&u&&u.row>=s.min.row&&u.row<=s.max.row&&u.col>=s.min.col&&u.col<=s.max.col,T=d&&s&&u&&u.row===-1&&u.col>=s.min.col&&u.col<=s.max.col,O=d&&s&&u&&u.row>=s.min.row&&u.row<=s.max.row&&u.col===-1,C=D&&s&&u&&u.row>=s.min.row&&u.row<=s.max.row;if(d&&!z&&ae({x:r.clientX,y:r.clientY,cursorIndex:u}),(!(r.shiftKey&&o)||d)&&e.length>0&&R(u&&{col:(S||T)&&o?o.col:Math.max(0,D?0:u.col),row:(S||O||C)&&o?o.row:Math.max(0,u.row),doNotScrollX:!!(S&&o||D||u.col===-1),doNotScrollY:!!(S&&o||u.row===-1)}),b&&!d&&(H.current=o),U(!!(b&&!d)),ze(u&&!d?{columns:u.col!==-1&&!D||!!(r.shiftKey&&o),rows:u.row!==-1||!!(r.shiftKey&&o),active:!0}:{columns:!1,rows:!1,active:!1}),r.shiftKey&&o&&!d)M(u&&{col:Math.max(0,u.col-(D?1:0)),row:Math.max(0,u.row)});else if(!S){if(u&&((u==null?void 0:u.col)===-1||(u==null?void 0:u.row)===-1||D)){let Z=u.col,ie=u.row,re=!1,de=!1;(u.col===-1||D)&&(Z=f.length-(N?3:2),re=!0),u.row===-1&&(ie=e.length-1,de=!0),T&&Y&&(Z=Y.col,de=!0),(O||C)&&Y&&(ie=Y.row,re=!0),M({col:Z,row:ie,doNotScrollX:re,doNotScrollY:de})}else M(null);p&&r.preventDefault()}},[Fe,Ge.length,Pe,k,o,f,te,s,N,z,ze,R,M,Y,e.length]);pe("mousedown",xn);let wn=_(()=>{var r,d,p,u,b,D,S,T,O;if(We!==null){if(Ke>0&&o){let C=[],V=(s==null?void 0:s.min)||o,B=(s==null?void 0:s.max)||o;for(let ne=V.row;ne<=B.row;++ne){C.push([]);for(let Z=V.col;Z<=B.col;++Z){let{copyValue:ie=()=>null}=f[Z+1];C[ne-V.row].push(String((r=ie({rowData:e[ne],rowIndex:ne}))!=null?r:""))}}Promise.all(C[0].map((ne,Z)=>{var de,ue;let ie=(de=f[V.col+Z+1])==null?void 0:de.prePasteValues,re=C.map(Tn=>Tn[Z]);return(ue=ie==null?void 0:ie(re))!=null?ue:re})).then(ne=>{var ie;C=C.map((re,de)=>ne.map(ue=>ue[de]));let Z=[...e];for(let re=0;re<C[0].length;re++){let de=(ie=f[V.col+re+1])==null?void 0:ie.pasteValue;if(de)for(let ue=B.row+1;ue<=B.row+Ke;ue++)te({col:re+V.col,row:ue})||(Z[ue]=de({rowData:Z[ue],value:C[(ue-B.row-1)%C.length][re],rowIndex:ue}))}l(Z,[{type:"UPDATE",fromRowIndex:B.row+1,toRowIndex:B.row+1+Ke}])}),Tt(0),R({col:Math.min((d=o==null?void 0:o.col)!=null?d:1/0,(p=s==null?void 0:s.min.col)!=null?p:1/0),row:Math.min((u=o==null?void 0:o.row)!=null?u:1/0,(b=s==null?void 0:s.min.row)!=null?b:1/0),doNotScrollX:!0,doNotScrollY:!0}),M({col:Math.max((D=o==null?void 0:o.col)!=null?D:0,(S=s==null?void 0:s.max.col)!=null?S:0),row:Math.max((T=o==null?void 0:o.row)!=null?T:0,(O=s==null?void 0:s.max.row)!=null?O:0)+Ke})}St(null)}ze({columns:!1,rows:!1,active:!1})},[We,ze,Ke,o,s==null?void 0:s.min,s==null?void 0:s.max,e,l,R,M,f,te]);pe("mouseup",wn);let yn=_(r=>{if(We!==null){let d=Pe(r);d&&(Tt(Math.max(0,d.row-We)),Te({col:d.col,row:Math.max(d.row,We)}))}if(be.active){let d=Pe(r),p=f.length-(N?3:2);M(d&&{col:be.columns?Math.max(0,Math.min(p,d.col)):p,row:be.rows?Math.max(0,d.row):e.length-1,doNotScrollX:!be.columns,doNotScrollY:!be.rows}),U(!1)}},[Te,be.active,be.columns,be.rows,Pe,f.length,N,M,e.length,We]);pe("mousemove",yn);let gn=_(r=>{var d;if(o&&!r.isComposing){if(r.key==="Tab"&&!r.shiftKey&&o.col===f.length-(N?3:2)&&!f[o.col+1].disableKeys)if(o.row===e.length-1){if(Le.current){r.preventDefault(),R(null),M(null),U(!1);let p=yt(),u=p.indexOf(Le.current);p[(u+1)%p.length].focus();return}}else{R(p=>{var u;return{col:0,row:((u=p==null?void 0:p.row)!=null?u:0)+1}}),M(null),U(!1),r.preventDefault();return}if(r.key==="Tab"&&r.shiftKey&&o.col===0&&!f[o.col+1].disableKeys)if(o.row===0){if(Be.current){r.preventDefault(),R(null),M(null),U(!1);let p=yt(),u=p.indexOf(Be.current);p[(u-1+p.length)%p.length].focus();return}}else{R(p=>{var u;return{col:f.length-(N?3:2),row:((u=p==null?void 0:p.row)!=null?u:1)-1}}),M(null),U(!1),r.preventDefault();return}if((d=r.key)!=null&&d.startsWith("Arrow")||r.key==="Tab"){if(k&&f[o.col+1].disableKeys||k&&["ArrowLeft","ArrowRight"].includes(r.key))return;let p=([u,b],D)=>D&&{col:Math.max(0,Math.min(f.length-(N?3:2),D.col+u)),row:Math.max(0,Math.min(e.length-1,D.row+b))};if(r.key==="Tab"&&r.shiftKey)R(u=>p([-1,0],u)),M(null);else{let u={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[r.key];(r.ctrlKey||r.metaKey)&&(u[0]*=f.length,u[1]*=e.length),r.shiftKey?M(b=>p(u,b||o)):(R(b=>p(u,b)),M(null))}U(!1),r.preventDefault()}else r.key==="Escape"?(!k&&!Y&&R(null),M(null),U(!1)):(r.key==="Enter"||r.key==="F2")&&!r.ctrlKey&&!r.metaKey&&!r.altKey&&!r.shiftKey?(M(null),k?f[o.col+1].disableKeys||(ut(),r.preventDefault()):te(o)||(H.current=o,U(!0),Te(o),r.preventDefault())):r.key==="Enter"&&!r.ctrlKey&&!r.metaKey&&!r.altKey&&r.shiftKey?Ce((s==null?void 0:s.max.row)||o.row):r.key==="d"&&(r.ctrlKey||r.metaKey)&&!r.altKey&&!r.shiftKey?(_e((s==null?void 0:s.min.row)||o.row,s==null?void 0:s.max.row),r.preventDefault()):(Yt(r.key)||r.code.match(/Key[A-Z]$/))&&!r.ctrlKey&&!r.metaKey&&!r.altKey?!k&&!te(o)&&(H.current=o,M(null),U(!0),Te(o)):["Backspace","Delete"].includes(r.key)?k||(rt(),r.preventDefault()):r.key==="a"&&(r.ctrlKey||r.metaKey)&&(k||(R({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),M({col:f.length-(N?3:2),row:e.length-1,doNotScrollY:!0,doNotScrollX:!0}),r.preventDefault()))}},[o,f,e.length,rt,_e,k,Ce,te,Te,s==null?void 0:s.max.row,s==null?void 0:s.min.row,Y,R,M,ut,N]);pe("keydown",gn);let bn=_(r=>{var b;let d=((b=De.current)==null?void 0:b.contains(r.target))||!1,p=d?Pe(r,!0,!0):null,u=p&&o&&o.col===p.col&&o.row===p.row&&k;d&&!u&&r.preventDefault()},[Pe,o,k]);pe("contextmenu",bn),Ve(()=>{let r=[];(o==null?void 0:o.row)!==void 0&&r.push({type:"COPY",action:()=>{Ye(),ae(null)}},{type:"CUT",action:()=>{ct(),ae(null)}},{type:"PASTE",action:()=>ve(null,null,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(p=>ve(null,null,function*(){let u=[[""]];if(p.types.includes("text/html")){let b=yield p.getType("text/html");u=st(yield b.text())}else if(p.types.includes("text/plain")){let b=yield p.getType("text/plain");u=qe(yield b.text())}else if(p.types.includes("text")){let b=yield p.getType("text");u=st(yield b.text())}$e(u)}));else if(navigator.clipboard.readText!==void 0){let d=yield navigator.clipboard.readText();$e(qe(d))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");ae(null)})}),(s==null?void 0:s.max.row)!==void 0?r.push({type:"INSERT_ROW_BELLOW",action:()=>{ae(null),Ce(s.max.row)}}):(o==null?void 0:o.row)!==void 0&&r.push({type:"INSERT_ROW_BELLOW",action:()=>{ae(null),Ce(o.row)}}),(s==null?void 0:s.min.row)!==void 0&&s.min.row!==s.max.row?r.push({type:"DUPLICATE_ROWS",fromRow:s.min.row+1,toRow:s.max.row+1,action:()=>{ae(null),_e(s.min.row,s.max.row)}}):(o==null?void 0:o.row)!==void 0&&r.push({type:"DUPLICATE_ROW",action:()=>{ae(null),_e(o.row)}}),(s==null?void 0:s.min.row)!==void 0&&s.min.row!==s.max.row?r.push({type:"DELETE_ROWS",fromRow:s.min.row+1,toRow:s.max.row+1,action:()=>{ae(null),Ue(s.min.row,s.max.row)}}):(o==null?void 0:o.row)!==void 0&&r.push({type:"DELETE_ROW",action:()=>{ae(null),Ue(o.row)}}),dn(r),r.length||ae(null)},[s,o,Ue,_e,Ce,ct,Ye,$e]);let Et=Ne(Ge);Et.current=Ge;let Cn=_(()=>Et.current,[]);ur(ye,()=>({activeCell:Ae(o,f),selection:wt(s!=null?s:o?{min:o,max:o}:null,f),setSelection:r=>{let d=$t(r,f.length-(N?2:1),e.length,f);R((d==null?void 0:d.min)||null),U(!1),ze({columns:!1,active:!1,rows:!1}),M((d==null?void 0:d.max)||null)},setActiveCell:r=>{let d=at(r,f.length-(N?2:1),e.length,f);R(d),U(!1),ze({columns:!1,active:!1,rows:!1}),M(null)}}));let Ie=Ne({onFocus:A,onBlur:ce,onActiveCellChange:L,onSelectionChange:fe});return Ie.current.onFocus=A,Ie.current.onBlur=ce,Ie.current.onActiveCellChange=L,Ie.current.onSelectionChange=fe,Ve(()=>{H.current&&(k?Ie.current.onFocus({cell:Ae(H.current,f)}):Ie.current.onBlur({cell:Ae(H.current,f)}))},[k,f]),Ve(()=>{Ie.current.onActiveCellChange({cell:Ae(o,f)})},[o==null?void 0:o.col,o==null?void 0:o.row,f]),Ve(()=>{Ie.current.onSelectionChange({selection:wt(s!=null?s:o?{min:o,max:o}:null,f)})},[(Pt=s==null?void 0:s.min.col)!=null?Pt:o==null?void 0:o.col,(Rt=s==null?void 0:s.min.row)!=null?Rt:o==null?void 0:o.row,(At=s==null?void 0:s.max.col)!=null?At:o==null?void 0:o.col,(kt=s==null?void 0:s.max.row)!=null?kt:o==null?void 0:o.row,o==null?void 0:o.col,o==null?void 0:o.row,f]),Se.createElement("div",{className:t,style:n},Se.createElement("div",{ref:Be,tabIndex:i.length&&e.length?0:void 0,onFocus:r=>{r.target.blur(),R({col:0,row:0})}}),Se.createElement(qt,{columns:f,outerRef:q,columnWidths:se,hasStickyRightColumn:N,displayHeight:Oe,data:e,fullWidth:Xe,headerRowHeight:m,activeCell:o,innerRef:De,rowHeight:y,rowKey:I,selection:s,rowClassName:he,editing:k,getContextMenuItems:Cn,setRowData:fn,deleteRows:Ue,insertRowAfter:Ce,duplicateRows:_e,stopEditing:ut,cellClassName:v,onScroll:we},Se.createElement(bt,{columnRights:me,columnWidths:se,activeCell:o,selection:s,headerRowHeight:m,rowHeight:y,hasStickyRightColumn:N,dataLength:e.length,viewHeight:ge,viewWidth:xe,contentWidth:Xe?void 0:mn,edges:nt,editing:k,isCellDisabled:te,expandSelection:pn})),Se.createElement("div",{ref:Le,tabIndex:i.length&&e.length?0:void 0,onFocus:r=>{r.target.blur(),R({col:f.length-(N?3:2),row:e.length-1})}}),!g&&E&&Se.createElement(E,{addRows:r=>Ce(e.length-1,r)}),Fe&&Ge.length>0&&Se.createElement(Q,{clientX:Fe.x,clientY:Fe.y,cursorIndex:Fe.cursorIndex,items:Ge,close:()=>ae(null)}))}));Qe.displayName="DataSheetGrid";import{useState as wr}from"react";import Zt from"react";var Qt=Zt.forwardRef(($,X)=>{var J=$,{columns:e,gutterColumn:t,stickyRightColumn:n,addRowsComponent:a,createRow:l,duplicateRow:i,style:c,rowKey:m,onFocus:h,onBlur:x,onActiveCellChange:I,onSelectionChange:E,rowClassName:w,rowHeight:G}=J,g=lt(J,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);let[Q]=wr({columns:e,gutterColumn:t,stickyRightColumn:n,addRowsComponent:a,createRow:l,duplicateRow:i,style:c,rowKey:m,onFocus:h,onBlur:x,onActiveCellChange:I,onSelectionChange:E,rowClassName:w,rowHeight:G});return Zt.createElement(Qe,oe(j(j({},Q),g),{rowHeight:typeof G=="number"?G:Q.rowHeight,ref:X}))});import tn,{useEffect as gr,useLayoutEffect as br,useRef as nn}from"react";import Cr from"classnames";import{useRef as yr}from"react";var en=()=>{let e=yr(!0),t=e.current;return e.current=!1,t};var rn=tn.memo(({active:e,focus:t,rowData:n,setRowData:a,columnData:{placeholder:l,alignRight:i,formatInputOnFocus:c,formatBlurredInput:m,parseUserInput:h,continuousUpdates:x}})=>{let I=nn(null),E=en(),w=nn({rowData:n,formatInputOnFocus:c,formatBlurredInput:m,setRowData:a,parseUserInput:h,continuousUpdates:x,firstRender:E,focusedAt:0,changedAt:0,escPressed:!1});return w.current={rowData:n,formatInputOnFocus:c,formatBlurredInput:m,setRowData:a,parseUserInput:h,continuousUpdates:x,firstRender:E,focusedAt:w.current.focusedAt,changedAt:w.current.changedAt,escPressed:w.current.escPressed},br(()=>{t?(I.current&&(I.current.value=w.current.formatInputOnFocus(w.current.rowData),I.current.focus(),I.current.select()),w.current.escPressed=!1,w.current.focusedAt=Date.now()):I.current&&(!w.current.escPressed&&!w.current.continuousUpdates&&!w.current.firstRender&&w.current.changedAt>=w.current.focusedAt&&w.current.setRowData(w.current.parseUserInput(I.current.value)),I.current.blur())},[t]),gr(()=>{!t&&I.current&&(I.current.value=w.current.formatBlurredInput(n))},[t,n]),tn.createElement("input",{defaultValue:m(n),className:Cr("dsg-input",i&&"dsg-input-align-right"),placeholder:e?l:void 0,tabIndex:-1,ref:I,style:{pointerEvents:t?"auto":"none"},onChange:G=>{w.current.changedAt=Date.now(),x&&a(h(G.target.value))},onKeyDown:G=>{G.key==="Escape"&&(w.current.escPressed=!0)}})});rn.displayName="TextComponent";var Tr=Me();function Me({placeholder:e,alignRight:t=!1,continuousUpdates:n=!0,deletedValue:a=null,parseUserInput:l=x=>x.trim()||null,formatBlurredInput:i=x=>String(x!=null?x:""),formatInputOnFocus:c=x=>String(x!=null?x:""),formatForCopy:m=x=>String(x!=null?x:""),parsePastedValue:h=x=>x.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:rn,columnData:{placeholder:e,alignRight:t,continuousUpdates:n,formatInputOnFocus:c,formatBlurredInput:i,parseUserInput:l},deleteValue:()=>a,copyValue:({rowData:x})=>m(x),pasteValue:({value:x})=>h(x),isCellEmpty:({rowData:x})=>x==null}}import on,{useLayoutEffect as Sr,useRef as Dr}from"react";var Ir=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],ln=on.memo(({focus:e,rowData:t,setRowData:n,active:a,stopEditing:l,disabled:i})=>{let c=Dr(null);return Sr(()=>{e&&(n(!t),l({nextRow:!1}))},[e,l]),on.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:c,disabled:i,checked:!!t,onMouseDown:()=>!a&&n(!t),onChange:()=>null})});ln.displayName="CheckboxComponent";var Er={component:ln,deleteValue:()=>!1,copyValue:({rowData:e})=>e?"YES":"NO",pasteValue:({value:e})=>!Ir.includes(e.toLowerCase()),isCellEmpty:({rowData:e})=>!e};var Nr=Me({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{let t=parseFloat(e);return isNaN(t)?null:t},parsePastedValue:e=>{let t=parseFloat(e);return isNaN(t)?null:t}});var Mr=Me({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{let t=parseFloat(e);return isNaN(t)?null:Math.round(t)},parsePastedValue:e=>{let t=parseFloat(e);return isNaN(t)?null:Math.round(t)}});var Pr=1e12,Rr=1e10,Ar=Me({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(e):"",formatInputOnFocus:e=>typeof e=="number"&&!isNaN(e)?String(Math.round(e*Pr)/Rr):"",parseUserInput:e=>{let t=parseFloat(e);return isNaN(t)?null:t/100},parsePastedValue:e=>{let t=parseFloat(e);return isNaN(t)?null:t}});import sn,{useLayoutEffect as kr,useRef as Vr}from"react";import Br from"classnames";var an=sn.memo(({focus:e,active:t,rowData:n,setRowData:a})=>{var i;let l=Vr(null);return kr(()=>{var c,m;e?(c=l.current)==null||c.select():(m=l.current)==null||m.blur()},[e]),sn.createElement("input",{className:Br("dsg-input",!t&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:l,style:{pointerEvents:e?"auto":"none",opacity:n||t?void 0:0},value:(i=n==null?void 0:n.toISOString().substr(0,10))!=null?i:"",onChange:c=>{let m=new Date(c.target.value);a(isNaN(m.getTime())?null:m)}})});an.displayName="DateComponent";var Lr={component:an,deleteValue:()=>null,copyValue:({rowData:e})=>e?e.toISOString().substr(0,10):null,pasteValue:({value:e})=>{let t=new Date(e.replace(/\.\s?|\//g,"-"));return isNaN(t.getTime())?null:t},minWidth:170,isCellEmpty:({rowData:e})=>!e};import un,{useLayoutEffect as Or,useRef as Fr}from"react";import Gr from"classnames";var cn=un.memo(({focus:e,active:t,rowData:n,setRowData:a})=>{let l=Fr(null);return Or(()=>{var i,c;e?(i=l.current)==null||i.select():(c=l.current)==null||c.blur()},[e]),un.createElement("input",{className:Gr("dsg-input",!t&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:l,style:{pointerEvents:e?"auto":"none",opacity:n||t?void 0:0},value:n!=null?n:"",onChange:i=>{let c=new Date(i.target.value);a(isNaN(c.getTime())?null:c.toISOString().substr(0,10))}})});cn.displayName="IsoDateComponent";var Kr={component:cn,deleteValue:()=>null,copyValue:({rowData:e})=>e,pasteValue:({value:e})=>{let t=new Date(e.replace(/\.\s?|\//g,"-"));return isNaN(t.getTime())?null:t.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:e})=>!e};import Ct,{useCallback as Wr,useRef as zr}from"react";var _r=i=>{var c=i,{columnData:{key:e,original:t},rowData:n,setRowData:a}=c,l=lt(c,["columnData","rowData","setRowData"]);let m=zr(n);m.current=n;let h=Wr(I=>{a(oe(j({},m.current),{[e]:I}))},[e,a]);if(!t.component)return Ct.createElement(Ct.Fragment,null);let x=t.component;return Ct.createElement(x,j({columnData:t.columnData,setRowData:h,rowData:n[e]},l))},Ur=(e,t)=>oe(j({id:e},t),{columnData:{key:e,original:t},component:_r,copyValue:({rowData:n,rowIndex:a})=>{var l,i;return(i=(l=t.copyValue)==null?void 0:l.call(t,{rowData:n[e],rowIndex:a}))!=null?i:null},deleteValue:({rowData:n,rowIndex:a})=>{var l,i;return oe(j({},n),{[e]:(i=(l=t.deleteValue)==null?void 0:l.call(t,{rowData:n[e],rowIndex:a}))!=null?i:null})},pasteValue:({rowData:n,value:a,rowIndex:l})=>{var i,c;return oe(j({},n),{[e]:(c=(i=t.pasteValue)==null?void 0:i.call(t,{rowData:n[e],value:a,rowIndex:l}))!=null?c:null})},disabled:typeof t.disabled=="function"?({rowData:n,rowIndex:a})=>{var l;return typeof t.disabled=="function"?t.disabled({rowData:n[e],rowIndex:a}):(l=t.disabled)!=null?l:!1}:t.disabled,cellClassName:typeof t.cellClassName=="function"?({rowData:n,rowIndex:a,columnId:l})=>{var i;return typeof t.cellClassName=="function"?t.cellClassName({rowData:n[e],rowIndex:a,columnId:l}):(i=t.cellClassName)!=null?i:void 0}:t.cellClassName,isCellEmpty:({rowData:n,rowIndex:a})=>{var l,i;return(i=(l=t.isCellEmpty)==null?void 0:l.call(t,{rowData:n[e],rowIndex:a}))!=null?i:!1}});var jl=Qe,Xl=Qt;export{Xl as DataSheetGrid,jl as DynamicDataSheetGrid,Er as checkboxColumn,zt as createAddRowsComponent,Ut as createContextMenuComponent,Me as createTextColumn,Lr as dateColumn,Nr as floatColumn,Mr as intColumn,Kr as isoDateColumn,Ur as keyColumn,Ar as percentColumn,ht as renderContextMenuItem,Tr as textColumn};
