"use strict";var Jn=Object.create;var tt=Object.defineProperty,Hn=Object.defineProperties,Zn=Object.getOwnPropertyDescriptor,Qn=Object.getOwnPropertyDescriptors,er=Object.getOwnPropertyNames,pt=Object.getOwnPropertySymbols,tr=Object.getPrototypeOf,Tt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var Xt=(e,t,n)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X=(e,t)=>{for(var n in t||(t={}))Tt.call(t,n)&&Xt(e,n,t[n]);if(pt)for(var n of pt(t))Yt.call(t,n)&&Xt(e,n,t[n]);return e},se=(e,t)=>Hn(e,Qn(t));var ft=(e,t)=>{var n={};for(var a in e)Tt.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&pt)for(var a of pt(e))t.indexOf(a)<0&&Yt.call(e,a)&&(n[a]=e[a]);return n};var nr=(e,t)=>{for(var n in t)tt(e,n,{get:t[n],enumerable:!0})},$t=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of er(t))!Tt.call(e,o)&&o!==n&&tt(e,o,{get:()=>t[o],enumerable:!(a=Zn(t,o))||a.enumerable});return e};var _=(e,t,n)=>(n=e!=null?Jn(tr(e)):{},$t(t||!e||!e.__esModule?tt(n,"default",{value:e,enumerable:!0}):n,e)),rr=e=>$t(tt({},"__esModule",{value:!0}),e);var nt=(e,t,n)=>new Promise((a,o)=>{var i=h=>{try{m(n.next(h))}catch(x){o(x)}},c=h=>{try{m(n.throw(h))}catch(x){o(x)}},m=h=>h.done?a(h.value):Promise.resolve(h.value).then(i,c);m((n=n.apply(e,t)).next())});var Sr={};nr(Sr,{DataSheetGrid:()=>Tr,DynamicDataSheetGrid:()=>Cr,checkboxColumn:()=>Nn,createAddRowsComponent:()=>It,createContextMenuComponent:()=>Nt,createTextColumn:()=>Ne,dateColumn:()=>Vn,floatColumn:()=>Mn,intColumn:()=>Pn,isoDateColumn:()=>On,keyColumn:()=>Fn,percentColumn:()=>Rn,renderContextMenuItem:()=>wt,textColumn:()=>In});module.exports=rr(Sr);var w=_(require("react"),1);var vt=require("react"),or=(e,t)=>{let n=t.map(({basis:o,minWidth:i,maxWidth:c})=>({basis:o,minWidth:i,maxWidth:c,size:o,violation:0,frozen:!1,factor:0})),a=n.reduce((o,i)=>o-i.size,e);a>0?t.forEach(({grow:o},i)=>{n[i].factor=o}):a<0&&t.forEach(({shrink:o},i)=>{n[i].factor=o});for(let o of n)o.factor===0&&(o.frozen=!0);for(;n.some(({frozen:o})=>!o);){let o=n.reduce((c,m)=>c+(m.frozen?0:m.factor),0),i=0;for(let c of n)c.frozen||(c.size+=a*c.factor/o,c.size<c.minWidth?c.violation=c.minWidth-c.size:c.maxWidth!==void 0&&c.size>c.maxWidth?c.violation=c.maxWidth-c.size:c.violation=0,c.size+=c.violation,i+=c.violation);if(i>0)for(let c of n)c.violation>0&&(c.frozen=!0);else if(i<0)for(let c of n)c.violation<0&&(c.frozen=!0);else break;a=n.reduce((c,m)=>c-m.size,e)}return n.map(({size:o})=>o)},qt=(e,t)=>{let n=e.map(({basis:a,minWidth:o,maxWidth:i,grow:c,shrink:m})=>[a,o,i,c,m].join(",")).join("|");return(0,vt.useMemo)(()=>{if(t===void 0)return{fullWidth:!1,columnWidths:void 0,columnRights:void 0,totalWidth:void 0};let a=or(t,e),o=0,i=a.map((c,m)=>(o+=c,m===a.length-1?1/0:o));return{fullWidth:Math.abs(t-o)<.1,columnWidths:a,columnRights:i,totalWidth:o}},[t,n])};var wn=require("react-resize-detector");var ge=_(require("react"),1);var lr=()=>ge.default.createElement(ge.default.Fragment,null),sr=()=>!1,Jt=({rowData:e})=>e,ar=()=>null,ir=({rowIndex:e})=>ge.default.createElement(ge.default.Fragment,null,e+1),St=()=>!0,ur=e=>e,cr=e=>{if(typeof e=="number")return{basis:0,grow:e,shrink:1};if(e.match(/^ *\d+(\.\d*)? *$/))return{basis:0,grow:parseFloat(e.trim()),shrink:1};if(e.match(/^ *\d+(\.\d*)? *px *$/))return{basis:parseFloat(e.trim()),grow:1,shrink:1};if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *$/)){let[t,n]=e.trim().split(" ");return{basis:0,grow:parseFloat(t),shrink:parseFloat(n)}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? *px *$/)){let[t,n]=e.trim().split(" ");return{basis:parseFloat(n),grow:parseFloat(t),shrink:1}}if(e.match(/^ *\d+(\.\d*)? \d+(\.\d*)? \d+(\.\d*)? *px *$/)){let[t,n,a]=e.trim().split(" ");return{basis:parseFloat(a),grow:parseFloat(t),shrink:parseFloat(n)}}return{basis:0,grow:1,shrink:1}},Ht=(e,t,n)=>(0,ge.useMemo)(()=>{var o,i,c,m,h,x,E,N,y,K;let a=[t===!1?{basis:0,grow:0,shrink:0,minWidth:0,component:()=>ge.default.createElement(ge.default.Fragment,null),headerClassName:"dsg-hidden-cell",cellClassName:"dsg-hidden-cell",isCellEmpty:St}:se(X({},t),{basis:(o=t==null?void 0:t.basis)!=null?o:40,grow:(i=t==null?void 0:t.grow)!=null?i:0,shrink:(c=t==null?void 0:t.shrink)!=null?c:0,minWidth:(m=t==null?void 0:t.minWidth)!=null?m:0,title:(h=t==null?void 0:t.title)!=null?h:ge.default.createElement("div",{className:"dsg-corner-indicator"}),component:(x=t==null?void 0:t.component)!=null?x:ir,isCellEmpty:St}),...e];return n&&a.push(se(X({},n),{basis:(E=n==null?void 0:n.basis)!=null?E:40,grow:(N=n==null?void 0:n.grow)!=null?N:0,shrink:(y=n==null?void 0:n.shrink)!=null?y:0,minWidth:(K=n.minWidth)!=null?K:0,isCellEmpty:St})),a.map(b=>{var q,Z,te,R,k,me,O,xe,we,J,Ce,Te,Q,U,f,M;let Y=b.width!==void 0?cr(b.width):{basis:void 0,grow:void 0,shrink:void 0};return se(X({},b),{basis:(Z=(q=b.basis)!=null?q:Y.basis)!=null?Z:0,grow:(R=(te=b.grow)!=null?te:Y.grow)!=null?R:1,shrink:(me=(k=b.shrink)!=null?k:Y.shrink)!=null?me:1,minWidth:(O=b.minWidth)!=null?O:100,component:(xe=b.component)!=null?xe:lr,disableKeys:(we=b.disableKeys)!=null?we:!1,disabled:(J=b.disabled)!=null?J:!1,keepFocus:(Ce=b.keepFocus)!=null?Ce:!1,deleteValue:(Te=b.deleteValue)!=null?Te:Jt,copyValue:(Q=b.copyValue)!=null?Q:ar,pasteValue:(U=b.pasteValue)!=null?U:Jt,prePasteValues:(f=b.prePasteValues)!=null?f:ur,isCellEmpty:(M=b.isCellEmpty)!=null?M:sr})})},[t,n,e]);var Qt=require("react"),en=require("throttle-debounce");var ht=require("react"),Zt=_(require("fast-deep-equal"),1),qe=e=>{let[t,n]=(0,ht.useState)(e),a=(0,ht.useCallback)(o=>{n(i=>{let c=typeof o=="function"?o(i):o;return(0,Zt.default)(c,i)?i:c})},[n]);return[t,a]};var tn=(e,t,n)=>{let[a,o]=qe({top:!0,right:!0,bottom:!0,left:!0});return(0,Qt.useEffect)(()=>{let i=(0,en.throttle)(100,()=>{var m,h,x,E,N,y,K,b,Y,q;o({top:((m=e.current)==null?void 0:m.scrollTop)===0,right:((x=(h=e.current)==null?void 0:h.scrollLeft)!=null?x:0)>=((N=(E=e.current)==null?void 0:E.scrollWidth)!=null?N:0)-(t!=null?t:0)-1,bottom:((K=(y=e.current)==null?void 0:y.scrollTop)!=null?K:0)>=((Y=(b=e.current)==null?void 0:b.scrollHeight)!=null?Y:0)-(n!=null?n:0)-1,left:((q=e.current)==null?void 0:q.scrollLeft)===0})}),c=e.current;return c==null||c.addEventListener("scroll",i),setTimeout(i,100),()=>{c==null||c.removeEventListener("scroll",i),i.cancel()}},[n,t,e,o]),a};var nn=require("react"),fe=(e,t)=>{(0,nn.useEffect)(()=>(document.addEventListener(e,t),()=>{document.removeEventListener(e,t)}),[t,e])};var Je=require("react"),rn=require("throttle-debounce"),Dt=(e,t=200)=>{let n=(0,Je.useRef)(null),a=(0,Je.useMemo)(()=>(0,rn.throttle)(t,!0,()=>{setTimeout(()=>{var o;return n.current=((o=e.current)==null?void 0:o.getBoundingClientRect())||null},0)}),[e,t]);return(0,Je.useCallback)((o=!1)=>{var i;return o?n.current=((i=e.current)==null?void 0:i.getBoundingClientRect())||null:a(),n.current},[e,a])};var Be=_(require("react"),1),It=(e={})=>({addRows:t})=>{var c,m;let[n,a]=(0,Be.useState)(1),[o,i]=(0,Be.useState)(String(n));return Be.default.createElement("div",{className:"dsg-add-row"},Be.default.createElement("button",{type:"button",className:"dsg-add-row-btn",onClick:()=>t(n)},(c=e.button)!=null?c:"Add")," ",Be.default.createElement("input",{className:"dsg-add-row-input",value:o,onBlur:()=>i(String(n)),type:"number",min:1,onChange:h=>{i(h.target.value),a(Math.max(1,Math.round(parseInt(h.target.value)||0)))},onKeyDown:h=>{h.key==="Enter"&&t(n)}})," ",(m=e.unit)!=null?m:"rows")},Et=It();Et.displayName="AddRows";var Re=require("react"),on=require("throttle-debounce"),ln=(e,t)=>{let[n,a]=(0,Re.useState)(e),o=(0,Re.useRef)();(0,Re.useEffect)(()=>()=>{var c;return(c=o.current)==null?void 0:c.cancel()},[]);let i=(0,Re.useMemo)(()=>o.current=(0,on.debounce)(t,c=>{a(c)}),[t]);return[n,i]};var yn=_(require("fast-deep-equal"),1);var G=_(require("react"),1),xt=require("react");var wt=e=>e.type==="CUT"?G.createElement(G.Fragment,null,"Cut"):e.type==="COPY"?G.createElement(G.Fragment,null,"Copy"):e.type==="PASTE"?G.createElement(G.Fragment,null,"Paste"):e.type==="DELETE_ROW"?G.createElement(G.Fragment,null,"Delete row"):e.type==="DELETE_ROWS"?G.createElement(G.Fragment,null,"Delete rows ",G.createElement("b",null,e.fromRow)," to ",G.createElement("b",null,e.toRow)):e.type==="INSERT_ROW_BELLOW"?G.createElement(G.Fragment,null,"Insert row below"):e.type==="DUPLICATE_ROW"?G.createElement(G.Fragment,null,"Duplicate row"):e.type==="DUPLICATE_ROWS"?G.createElement(G.Fragment,null,"Duplicate rows ",G.createElement("b",null,e.fromRow)," to ",G.createElement("b",null,e.toRow)):e.type,Nt=(e=wt)=>({clientX:t,clientY:n,items:a,close:o})=>{let i=(0,xt.useRef)(null),c=(0,xt.useCallback)(m=>{var x;(x=i.current)!=null&&x.contains(m.target)||o()},[o]);return fe("mousedown",c),G.createElement("div",{className:"dsg-context-menu",style:{left:t+"px",top:n+"px"},ref:i},a.map(m=>G.createElement("div",{key:m.type,onClick:m.action,className:"dsg-context-menu-item"},e(m))))},Mt=Nt(wt);Mt.displayName="ContextMenu";var mr=typeof DOMParser!="undefined"?new DOMParser:{parseFromString:()=>null},sn=e=>mr.parseFromString(e,"text/html");var yt=e=>{var o,i;let t=sn(e.replace(/<br\/?>/g,`
`)),n=t.getElementsByTagName("table")[0];if(n){let c=[];for(let m=0;m<n.rows.length;m++){let h=[];c.push(h);for(let x=0;x<n.rows[m].cells.length;x++)h.push((o=n.rows[m].cells[x].textContent)!=null?o:"")}return c}let a=t.getElementsByTagName("span")[0];return a?[[(i=a.textContent)!=null?i:""]]:[[""]]},rt=e=>{let t=e.replace(/\r|\n$/g,""),n=[[]],a=0,o=0,i=!1,c=0,m=()=>{let h=t.slice(o,a);h[0]==='"'&&h[h.length-1]==='"'&&(i=!0),i&&h[h.length-1]==='"'&&h.includes(`
`)&&(h=h.slice(1,h.length-1).replace(/""/g,'"'),i=!1),i&&h[h.length-1]!=='"'?h.split(`
`).forEach((x,E,{length:N})=>{n[c].push(x),E<N-1&&(n.push([]),c++)}):n[c].push(h)};for(;a<t.length;)i&&t[a]==='"'&&![void 0,"	",'"'].includes(t[a+1])&&(i=!1),i&&t[a]==='"'&&t[a+1]==='"'&&a++,a===o&&t[a]==='"'&&(i=!0),t[a]==="	"&&(m(),o=a+1,i=!1),t[a]===`
`&&!i&&(m(),n.push([]),o=a+1,c++),a++;return m(),n},an=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),un=e=>e.match(/^[^\x00-\x20\x7F-\x9F]$/)!==null;var gt=(e,t,n,a)=>{if(e===null||!t||!n)return null;if(typeof e!="object")throw new Error("Value must be an object or null");let o=a.findIndex(c=>c.id===e.col),i={col:Math.max(0,Math.min(t-1,o===-1?Number(e.col):o-1)),row:Math.max(0,Math.min(n-1,Number(e.row)))};if(isNaN(i.col)||isNaN(i.row))throw new Error("col or cell are not valid positive numbers");return i},Le=(e,t)=>{var n;return e?{col:e.col,row:e.row,colId:(n=t[e.col+1])==null?void 0:n.id}:null},cn=(e,t,n,a)=>{if(e===null||!t||!n)return null;if(typeof e!="object")throw new Error("Value must be an object or null");let o={min:gt(e.min,t,n,a),max:gt(e.max,t,n,a)};if(!o.min||!o.max)throw new Error("min and max must be defined");return o},Pt=(e,t)=>e?{min:Le(e.min,t),max:Le(e.max,t)}:null;var Rt=()=>Array.from(document.querySelectorAll("*")).filter(e=>e instanceof HTMLElement&&typeof e.tabIndex=="number"&&e.tabIndex>=0&&!e.disabled&&(!(e instanceof HTMLAnchorElement)||!!e.href||e.getAttribute("tabIndex")!==null)&&getComputedStyle(e).visibility!=="collapse");var st=require("@tanstack/react-virtual"),he=_(require("react"),1),lt=_(require("classnames"),1);var mn=_(require("react"),1),dn=_(require("classnames"),1),At=({children:e,gutter:t,stickyRight:n,active:a,disabled:o,className:i,width:c,left:m})=>mn.default.createElement("div",{className:(0,dn.default)("dsg-cell",t&&"dsg-cell-gutter",o&&"dsg-cell-disabled",t&&a&&"dsg-cell-gutter-active",n&&"dsg-cell-sticky-right",i),style:{width:c,left:n?void 0:m}},e);var pn=require("react"),ot=(e,t)=>(0,pn.useMemo)(()=>{let n=new Map;return a=>(n.has(a)||n.set(a,(...o)=>{e(a,...o.slice(0,t))}),n.get(a))},[t,e]);var fn=({data:e,columns:t,outerRef:n,innerRef:a,columnWidths:o,hasStickyRightColumn:i,displayHeight:c,headerRowHeight:m,rowHeight:h,rowKey:x,fullWidth:E,selection:N,activeCell:y,rowClassName:K,cellClassName:b,children:Y,editing:q,getContextMenuItems:Z,setRowData:te,deleteRows:R,duplicateRows:k,insertRowAfter:me,stopEditing:O,onScroll:xe})=>{var Ke,We,ut,ct;let we=(0,st.useVirtualizer)({count:e.length,getScrollElement:()=>n.current,paddingStart:m,estimateSize:g=>h(g).height,getItemKey:g=>{if(x&&g>0){let W=e[g-1];if(typeof x=="function")return x({rowData:W,rowIndex:g});if(typeof x=="string"&&W instanceof Object&&x in W){let z=W[x];if(typeof z=="string"||typeof z=="number")return z}}return g},overscan:5}),J=(0,st.useVirtualizer)({count:t.length,getScrollElement:()=>n.current,estimateSize:g=>{var W;return(W=o==null?void 0:o[g])!=null?W:100},horizontal:!0,getItemKey:g=>{var W;return(W=t[g].id)!=null?W:g},overscan:1,rangeExtractor:g=>{let W=(0,st.defaultRangeExtractor)(g);return W[0]!==0&&W.unshift(0),i&&W[W.length-1]!==t.length-1&&W.push(t.length-1),W}});(0,he.useEffect)(()=>{J.measure()},[J,o]);let Ce=ot(te,1),Te=ot(R,0),Q=ot(k,0),U=ot(me,0),f=(Ke=N==null?void 0:N.min.col)!=null?Ke:y==null?void 0:y.col,M=(We=N==null?void 0:N.max.col)!=null?We:y==null?void 0:y.col,Me=(ut=N==null?void 0:N.min.row)!=null?ut:y==null?void 0:y.row,H=(ct=N==null?void 0:N.max.row)!=null?ct:y==null?void 0:y.row;return he.default.createElement("div",{ref:n,className:"dsg-container",onScroll:xe,style:{height:c}},he.default.createElement("div",{ref:a,style:{width:E?"100%":J.getTotalSize(),height:we.getTotalSize()}},m>0&&he.default.createElement("div",{className:(0,lt.default)("dsg-row","dsg-row-header"),style:{width:E?"100%":J.getTotalSize(),height:m}},J.getVirtualItems().map(g=>he.default.createElement(At,{key:g.key,gutter:g.index===0,stickyRight:i&&g.index===t.length-1,width:g.size,left:g.start,className:(0,lt.default)("dsg-cell-header",f!==void 0&&M!==void 0&&f<=g.index-1&&M>=g.index-1&&"dsg-cell-header-active",t[g.index].headerClassName)},he.default.createElement("div",{className:"dsg-cell-header-container"},t[g.index].title)))),we.getVirtualItems().map(g=>{let W=g.index>=(Me!=null?Me:1/0)&&g.index<=(H!=null?H:-1/0);return he.default.createElement("div",{key:g.key,className:(0,lt.default)("dsg-row",typeof K=="string"?K:null,typeof K=="function"?K({rowData:e[g.index],rowIndex:g.index}):null),style:{height:g.size,top:g.start,width:E?"100%":J.getTotalSize()}},J.getVirtualItems().map(z=>{let ze=t[z.index].cellClassName,ye=t[z.index].disabled,Se=t[z.index].component,mt=ye===!0||typeof ye=="function"&&ye({rowData:e[g.index],rowIndex:g.index}),Ze=(y==null?void 0:y.row)===g.index&&y.col===z.index-1;return he.default.createElement(At,{key:z.key,gutter:z.index===0,stickyRight:i&&z.index===t.length-1,active:z.index===0&&W,disabled:mt,className:(0,lt.default)(typeof ze=="function"?ze({rowData:e[g.index],rowIndex:g.index,columnId:t[z.index].id}):ze,typeof b=="function"?b({rowData:e[g.index],rowIndex:g.index,columnId:t[z.index].id}):b),width:z.size,left:z.start},he.default.createElement(Se,{rowData:e[g.index],getContextMenuItems:Z,disabled:mt,active:Ze,columnIndex:z.index-1,rowIndex:g.index,focus:Ze&&q,deleteRow:Te(g.index),duplicateRow:Q(g.index),stopEditing:O,insertRowBelow:U(g.index),setRowData:Ce(g.index),columnData:t[z.index].columnData}))}))}),Y))};var v=_(require("react"),1),Ae=_(require("classnames"),1);var hn=(e,t,n,a)=>[[a,e],[t,e],[t,n],[a,n],[a,e]],dr=(e,t,n,a)=>`polygon(evenodd, ${[...hn(0,"100%","100%",0),...hn(e,t,n,a)].map(i=>i.map(c=>typeof c=="number"&&c!==0?c+"px":c).join(" ")).join(",")})`,kt=v.default.memo(({columnWidths:e,columnRights:t,headerRowHeight:n,selection:a,rowHeight:o,activeCell:i,hasStickyRightColumn:c,dataLength:m,viewWidth:h,viewHeight:x,contentWidth:E,edges:N,isCellDisabled:y,editing:K,expandSelection:b})=>{var J,Ce,Te,Q;let Y=i?y(i):!1,q=(0,v.useMemo)(()=>{if(!a)return Y;for(let U=a.min.col;U<=a.max.col;++U)for(let f=a.min.row;f<=a.max.row;++f)if(!y({col:U,row:f}))return!1;return!0},[Y,y,a]);if(!e||!t)return null;let Z=U=>U<m-1?1:0,te=U=>U<e.length-(c?3:2)?1:0,R=i&&{width:e[i.col+1]+te(i.col),height:o(i.row).height+Z(i.row),left:t[i.col],top:o(i.row).top+n},k=a&&{width:e.slice(a.min.col+1,a.max.col+2).reduce((U,f)=>U+f)+te(a.max.col),height:o(a.max.row).top+o(a.max.row).height-o(a.min.row).top+Z(a.max.row),left:t[a.min.col],top:o(a.min.row).top+n},me=(a==null?void 0:a.min)||i,O=(a==null?void 0:a.max)||i,xe=O&&b!==null&&{left:t[O.col]+e[O.col+1],top:o(O.row).top+o(O.row).height+n,transform:`translate(-${O.col<e.length-(c?3:2)?50:100}%, -${O.row<m-1?50:100}%)`},we=me&&O&&b!==null&&{width:e.slice(me.col+1,O.col+2).reduce((U,f)=>U+f)+te(O.col),height:o(O.row+b).top+o(O.row+b).height-o(O.row+1).top+Z(O.row+b)-1,left:t[me.col],top:o(O.row).top+o(O.row).height+n+1};return v.default.createElement(v.default.Fragment,null,v.default.createElement("div",{className:"dsg-scrollable-view-container",style:{height:o(m-1).top+o(m-1).height+n,width:E||"100%"}},v.default.createElement("div",{className:(0,Ae.default)({"dsg-scrollable-view":!0,"dsg-scrollable-view-t":!N.top,"dsg-scrollable-view-r":!N.right,"dsg-scrollable-view-b":!N.bottom,"dsg-scrollable-view-l":!N.left}),style:{top:n,left:e[0],height:x?x-n:0,width:E&&h?h-e[0]-(c?e[e.length-1]:0):`calc(100% - ${e[0]+(c?e[e.length-1]:0)}px)`}})),(k||R)&&v.default.createElement("div",{className:"dsg-selection-col-marker-container",style:{left:(J=k==null?void 0:k.left)!=null?J:R==null?void 0:R.left,width:(Ce=k==null?void 0:k.width)!=null?Ce:R==null?void 0:R.width,height:o(m-1).top+o(m-1).height+n}},v.default.createElement("div",{className:(0,Ae.default)("dsg-selection-col-marker",q&&"dsg-selection-col-marker-disabled"),style:{top:n}})),(k||R)&&v.default.createElement("div",{className:"dsg-selection-row-marker-container",style:{top:(Te=k==null?void 0:k.top)!=null?Te:R==null?void 0:R.top,height:(Q=k==null?void 0:k.height)!=null?Q:R==null?void 0:R.height,width:E||"100%"}},v.default.createElement("div",{className:(0,Ae.default)("dsg-selection-row-marker",q&&"dsg-selection-row-marker-disabled"),style:{left:e[0]}})),R&&i&&v.default.createElement("div",{className:(0,Ae.default)("dsg-active-cell",{"dsg-active-cell-focus":K,"dsg-active-cell-disabled":Y}),style:R}),k&&R&&v.default.createElement("div",{className:(0,Ae.default)("dsg-selection-rect",q&&"dsg-selection-rect-disabled"),style:se(X({},k),{clipPath:dr(R.top-k.top,R.left-k.left,R.top+R.height-k.top,R.left+R.width-k.left)})}),we&&v.default.createElement("div",{className:(0,Ae.default)("dsg-expand-rows-rect"),style:we}),xe&&v.default.createElement("div",{className:(0,Ae.default)("dsg-expand-rows-indicator",q&&"dsg-expand-rows-indicator-disabled"),style:xe}))});kt.displayName="SelectionRect";var He=require("react"),xn=({value:e,rowHeight:t})=>{let n=(0,He.useRef)([]),[,a]=(0,He.useState)(0);return(0,He.useMemo)(()=>{let o=i=>{if(typeof t=="number")return Math.min(e.length-1,Math.max(-1,Math.floor(i/t)));let c=0,m=n.current.length-1;for(;c<=m;){let h=Math.floor((c+m)/2);if(n.current[h].top<i)c=h+1;else if(n.current[h].top>i)m=h-1;else return h}if(m===n.current.length-1&&e.length>n.current.length&&(!n.current.length||i>=n.current[m].top+n.current[m].height)){let h=m===-1?0:n.current[m].top+n.current[m].height;do{m++;let x=t({rowIndex:m,rowData:e[m]});n.current.push({height:x,top:h}),h+=x}while(h<=i&&m<n.current.length-1)}return m};return{resetAfter:i=>{n.current=n.current.slice(0,i),a(c=>c+1)},getRowSize:i=>{if(typeof t=="number")return{height:t,top:t*i};if(i>=e.length)return{height:0,top:0};if(i<n.current.length)return n.current[i];let c=n.current[n.current.length-1].top+n.current[n.current.length-1].height;for(let m=n.current.length;m<=i;m++){let h=t({rowIndex:m,rowData:e[m]});n.current.push({height:h,top:c}),c+=h}return n.current[i]},getRowIndex:o,totalSize:i=>{if(typeof t=="number")return e.length*t;let c=o(i);return n.current[c].top+n.current[c].height}}},[t,e])};var pr=[],fr=[],hr=()=>({}),at=()=>null,xr=({rowData:e})=>X({},e),it=w.default.memo(w.default.forwardRef(({value:e=pr,className:t,style:n,height:a=400,onChange:o=at,columns:i=fr,rowHeight:c=40,headerRowHeight:m=typeof c=="number"?c:40,gutterColumn:h,stickyRightColumn:x,rowKey:E,addRowsComponent:N=Et,createRow:y=hr,autoAddRow:K=!1,lockRows:b=!1,disableExpandSelection:Y=!1,disableSmartDelete:q=!1,duplicateRow:Z=xr,contextMenuComponent:te=Mt,disableContextMenu:R=!1,onFocus:k=at,onBlur:me=at,onActiveCellChange:O=at,onSelectionChange:xe=at,rowClassName:we,cellClassName:J,onScroll:Ce},Te)=>{var Kt,Wt,zt,_t,Ut,jt;let Q=(0,w.useRef)(null),U=R||b,f=Ht(i,h,x),M=!!x,Me=(0,w.useRef)(null),H=(0,w.useRef)(null),Ke=(0,w.useRef)(null),We=(0,w.useRef)(null),[ut,ct]=ln(1,100),{getRowSize:g,totalSize:W,getRowIndex:z}=xn({value:e,rowHeight:c}),ze=Math.min(a,m+W(a)+ut),{width:ye,height:Se}=(0,wn.useResizeDetector)({targetRef:H,refreshMode:"throttle",refreshRate:100});ct(Se?ze-Se:0);let mt=tn(H,ye,Se),{fullWidth:Ze,totalWidth:Gn,columnWidths:ae,columnRights:de}=qt(f,ye),[_e,ie]=(0,w.useState)(null),[Ue,Kn]=(0,w.useState)([]),[V,j]=(0,w.useState)(!1),[je,Bt]=(0,w.useState)(0),[Xe,Lt]=(0,w.useState)(null),[l,A]=qe(null),[$,P]=qe(null),s=(0,w.useMemo)(()=>l&&$&&{min:{col:Math.min(l.col,$.col),row:Math.min(l.row,$.row)},max:{col:Math.max(l.col,$.col),row:Math.max(l.row,$.row)}},[l,$]),[De,Ye]=qe({columns:!1,rows:!1,active:!1}),Wn=Y||V||De.active||(l==null?void 0:l.row)===(e==null?void 0:e.length)-1||(s==null?void 0:s.max.row)===(e==null?void 0:e.length)-1||l&&f.slice(((Kt=s==null?void 0:s.min.col)!=null?Kt:l.col)+1,((Wt=s==null?void 0:s.max.col)!=null?Wt:l.col)+2).every(r=>r.disabled===!0)?null:je,Ot=Dt(Me),Ft=Dt(H);(0,w.useEffect)(()=>{var r;l!==null&&(document.activeElement.blur(),(r=window.getSelection())==null||r.removeAllRanges())},[l!==null]);let Ve=(0,w.useCallback)((r,d=!1,p=!1)=>{let u=Ot(d),C=p&&Ft(d);if(u&&de&&ae){let I=r.clientX-u.left,D=r.clientY-u.top;return C&&(r.clientY-C.top<=m&&(D=0),r.clientX-C.left<=ae[0]&&(I=0),M&&C.right-r.clientX<=ae[ae.length-1]&&(I=de[de.length-2]+1)),{col:de.findIndex(S=>I<S)-1,row:z(D-m)}}return null},[de,ae,e.length,Ot,Ft,m,M,z]),ne=(0,w.useRef)(e);ne.current=e;let re=(0,w.useCallback)(r=>{let d=f[r.col+1].disabled;return!!(typeof d=="function"?d({rowData:ne.current[r.row],rowIndex:r.row}):d)},[f]),Ie=(0,w.useCallback)((r,d=1)=>{b||(P(null),j(!1),o([...ne.current.slice(0,r+1),...new Array(d).fill(0).map(y),...ne.current.slice(r+1)],[{type:"CREATE",fromRowIndex:r+1,toRowIndex:r+1+d}]),A(p=>({col:(p==null?void 0:p.col)||0,row:r+d,doNotScrollX:!0})))},[y,b,o,A,P]),$e=(0,w.useCallback)((r,d=r)=>{b||(o([...ne.current.slice(0,d+1),...ne.current.slice(r,d+1).map((p,u)=>Z({rowData:p,rowIndex:u+r})),...ne.current.slice(d+1)],[{type:"CREATE",fromRowIndex:d+1,toRowIndex:d+2+d-r}]),A({col:0,row:d+1,doNotScrollX:!0}),P({col:f.length-(M?3:2),row:2*d-r+1,doNotScrollX:!0}),j(!1))},[f.length,Z,b,o,A,P,M]),Ee=(0,w.useCallback)(r=>{if(!(!Se||!ye)){if(!r.doNotScrollY){let d=g(r.row).top,p=g(r.row).top+g(r.row).height+m-Se+1,u=H.current.scrollTop;u>d?H.current.scrollTop=d:u<p&&(H.current.scrollTop=p)}if(de&&ae&&H.current&&!r.doNotScrollX){let d=de[r.col]-de[0],p=de[r.col]+ae[r.col+1]+(M?ae[ae.length-1]:0)-ye+1,u=H.current.scrollLeft;u>d?H.current.scrollLeft=d:u<p&&(H.current.scrollLeft=p)}}},[Se,ye,m,de,ae,g,M]);(0,w.useEffect)(()=>{$&&Ee($)},[$,Ee]),(0,w.useEffect)(()=>{l&&Ee(l)},[l,Ee]);let zn=(0,w.useCallback)((r,d)=>{var p,u;o([...(p=ne.current)==null?void 0:p.slice(0,r),d,...(u=ne.current)==null?void 0:u.slice(r+1)],[{type:"UPDATE",fromRowIndex:r,toRowIndex:r+1}])},[o]),ve=(0,w.useCallback)((r,d=r)=>{b||(j(!1),A(p=>{let u=Math.min(ne.current.length-2-d+r,r);return u<0?null:p&&{col:p.col,row:u}}),P(null),o([...ne.current.slice(0,r),...ne.current.slice(d+1)],[{type:"DELETE",fromRowIndex:r,toRowIndex:d+1}]))},[b,o,A,P]),dt=(0,w.useCallback)((r=!0)=>{let d=r&&!q;if(!l)return;let p=(s==null?void 0:s.min)||l,u=(s==null?void 0:s.max)||l;if(e.slice(p.row,u.row+1).every((I,D)=>f.every(S=>S.isCellEmpty({rowData:I,rowIndex:D+p.row})))){d&&ve(p.row,u.row);return}let C=[...e];for(let I=p.row;I<=u.row;++I)for(let D=p.col;D<=u.col;++D)if(!re({col:D,row:I})){let{deleteValue:S=({rowData:F})=>F}=f[D+1];C[I]=S({rowData:C[I],rowIndex:I})}if(d&&(0,yn.default)(C,e)){A({col:0,row:p.row,doNotScrollX:!0}),P({col:f.length-(M?3:2),row:u.row,doNotScrollX:!0});return}o(C,[{type:"UPDATE",fromRowIndex:p.row,toRowIndex:u.row+1}])},[l,f,e,ve,re,o,s==null?void 0:s.max,s==null?void 0:s.min,A,P,M]),bt=(0,w.useCallback)(({nextRow:r=!0}={})=>{(l==null?void 0:l.row)===ne.current.length-1?r&&K?Ie(l.row):j(!1):(j(!1),r&&A(d=>d&&{col:d.col,row:d.row+1}))},[l==null?void 0:l.row,K,Ie,A]),Qe=(0,w.useCallback)(r=>nt(null,null,function*(){var d,p;if(!V&&l){let u=[],C=(s==null?void 0:s.min)||l,I=(s==null?void 0:s.max)||l;for(let T=C.row;T<=I.row;++T){u.push([]);for(let B=C.col;B<=I.col;++B){let{copyValue:L=()=>null}=f[B+1];u[T-C.row].push(L({rowData:e[T],rowIndex:T}))}}let D=u.map(T=>T.join("	")).join(`
`),S=`<table>${u.map(T=>`<tr>${T.map(B=>`<td>${an(String(B!=null?B:"")).replace(/\n/g,"<br/>")}</td>`).join("")}</tr>`).join("")}</table>`;if(r!==void 0){(d=r.clipboardData)==null||d.setData("text/plain",D),(p=r.clipboardData)==null||p.setData("text/html",S),r.preventDefault();return}let F=!1;if(navigator.clipboard.write!==void 0){let T=new Blob([D],{type:"text/plain"}),B=new Blob([S],{type:"text/html"}),L=[new ClipboardItem({"text/plain":T,"text/html":B})];yield navigator.clipboard.write(L).then(()=>{F=!0})}else navigator.clipboard.writeText!==void 0?yield navigator.clipboard.writeText(D).then(()=>{F=!0}):document.execCommand!==void 0&&document.execCommand("copy")&&(F=!0);F||alert("This action is unavailable in your browser, but you can still use Ctrl+C for copy or Ctrl+X for cut")}}),[l,f,e,V,s]);fe("copy",Qe);let Ct=(0,w.useCallback)(r=>{!V&&l&&(Qe(r),dt(!1))},[l,dt,V,Qe]);fe("cut",Ct);let et=(0,w.useCallback)(r=>nt(null,null,function*(){var d,p;if(!V&&l){let u=(s==null?void 0:s.min)||l,C=(s==null?void 0:s.max)||l,I=yield Promise.all(r[0].map((D,S)=>{var B,L;let F=(B=f[u.col+S+1])==null?void 0:B.prePasteValues,T=r.map(oe=>oe[S]);return(L=F==null?void 0:F(T))!=null?L:T}));if(r=r.map((D,S)=>I.map(F=>F[S])),r.length===1){let D=[...e];for(let S=0;S<r[0].length;S++){let F=(d=f[u.col+S+1])==null?void 0:d.pasteValue;if(F)for(let T=u.row;T<=C.row;T++)re({col:S+u.col,row:T})||(D[T]=yield F({rowData:D[T],value:r[0][S],rowIndex:T}))}o(D,[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:C.row+1}]),A({col:u.col,row:u.row}),P({col:Math.min(u.col+r[0].length-1,f.length-(M?3:2)),row:C.row})}else{let D=[...e],S=u.row+r.length-e.length;S>0&&(b?r.splice(r.length-S,S):D=[...D,...new Array(S).fill(0).map(()=>y())]);for(let T=0;T<r[0].length&&u.col+T<f.length-(M?2:1);T++){let B=(p=f[u.col+T+1])==null?void 0:p.pasteValue;if(B)for(let L=0;L<r.length;L++)re({col:u.col+T,row:u.row+L})||(D[u.row+L]=yield B({rowData:D[u.row+L],value:r[L][T],rowIndex:u.row+L}))}let F=[{type:"UPDATE",fromRowIndex:u.row,toRowIndex:u.row+r.length-(!b&&S>0?S:0)}];S>0&&!b&&F.push({type:"CREATE",fromRowIndex:u.row+r.length-S,toRowIndex:u.row+r.length}),o(D,F),A({col:u.col,row:u.row}),P({col:Math.min(u.col+r[0].length-1,f.length-(M?3:2)),row:u.row+r.length-1})}}}),[l,f,y,e,V,M,re,b,o,s==null?void 0:s.max,s==null?void 0:s.min,A,P]),_n=(0,w.useCallback)(r=>{var d,p,u,C,I,D;if(l&&!V){let S=[[""]];(d=r.clipboardData)!=null&&d.types.includes("text/html")?S=yt((p=r.clipboardData)==null?void 0:p.getData("text/html")):(u=r.clipboardData)!=null&&u.types.includes("text/plain")?S=rt((C=r.clipboardData)==null?void 0:C.getData("text/plain")):(I=r.clipboardData)!=null&&I.types.includes("text")&&(S=rt((D=r.clipboardData)==null?void 0:D.getData("text"))),et(S),r.preventDefault()}},[l,et,V]);fe("paste",_n);let Un=(0,w.useCallback)(r=>{var B,L,oe;if(_e&&Ue.length)return;let d=r.button===2||r.button===0&&r.ctrlKey,p=((B=Me.current)==null?void 0:B.contains(r.target))||!1,u=p?Ve(r,!0,!0):null;if(!p&&V&&l&&f[l.col+1].keepFocus)return;if(r.target instanceof HTMLElement&&r.target.className.includes("dsg-expand-rows-indicator")){Lt(Math.max((L=l==null?void 0:l.row)!=null?L:0,(oe=s==null?void 0:s.max.row)!=null?oe:0));return}let C=u&&l&&l.col===u.col&&l.row===u.row&&!re(l);if(C&&V)return;let I=(u==null?void 0:u.col)===f.length-2&&M,D=d&&s&&u&&u.row>=s.min.row&&u.row<=s.max.row&&u.col>=s.min.col&&u.col<=s.max.col,S=d&&s&&u&&u.row===-1&&u.col>=s.min.col&&u.col<=s.max.col,F=d&&s&&u&&u.row>=s.min.row&&u.row<=s.max.row&&u.col===-1,T=I&&s&&u&&u.row>=s.min.row&&u.row<=s.max.row;if(d&&!U&&ie({x:r.clientX,y:r.clientY,cursorIndex:u}),(!(r.shiftKey&&l)||d)&&e.length>0&&A(u&&{col:(D||S)&&l?l.col:Math.max(0,I?0:u.col),row:(D||F||T)&&l?l.row:Math.max(0,u.row),doNotScrollX:!!(D&&l||I||u.col===-1),doNotScrollY:!!(D&&l||u.row===-1)}),C&&!d&&(Q.current=l),j(!!(C&&!d)),Ye(u&&!d?{columns:u.col!==-1&&!I||!!(r.shiftKey&&l),rows:u.row!==-1||!!(r.shiftKey&&l),active:!0}:{columns:!1,rows:!1,active:!1}),r.shiftKey&&l&&!d)P(u&&{col:Math.max(0,u.col-(I?1:0)),row:Math.max(0,u.row)});else if(!D){if(u&&((u==null?void 0:u.col)===-1||(u==null?void 0:u.row)===-1||I)){let ee=u.col,ue=u.row,le=!1,pe=!1;(u.col===-1||I)&&(ee=f.length-(M?3:2),le=!0),u.row===-1&&(ue=e.length-1,pe=!0),S&&$&&(ee=$.col,pe=!0),(F||T)&&$&&(ue=$.row,le=!0),P({col:ee,row:ue,doNotScrollX:le,doNotScrollY:pe})}else P(null);p&&r.preventDefault()}},[_e,Ue.length,Ve,V,l,f,re,s,M,U,Ye,A,P,$,e.length]);fe("mousedown",Un);let jn=(0,w.useCallback)(()=>{var r,d,p,u,C,I,D,S,F;if(Xe!==null){if(je>0&&l){let T=[],B=(s==null?void 0:s.min)||l,L=(s==null?void 0:s.max)||l;for(let oe=B.row;oe<=L.row;++oe){T.push([]);for(let ee=B.col;ee<=L.col;++ee){let{copyValue:ue=()=>null}=f[ee+1];T[oe-B.row].push(String((r=ue({rowData:e[oe],rowIndex:oe}))!=null?r:""))}}Promise.all(T[0].map((oe,ee)=>{var pe,ce;let ue=(pe=f[B.col+ee+1])==null?void 0:pe.prePasteValues,le=T.map(qn=>qn[ee]);return(ce=ue==null?void 0:ue(le))!=null?ce:le})).then(oe=>{var ue;T=T.map((le,pe)=>oe.map(ce=>ce[pe]));let ee=[...e];for(let le=0;le<T[0].length;le++){let pe=(ue=f[B.col+le+1])==null?void 0:ue.pasteValue;if(pe)for(let ce=L.row+1;ce<=L.row+je;ce++)re({col:le+B.col,row:ce})||(ee[ce]=pe({rowData:ee[ce],value:T[(ce-L.row-1)%T.length][le],rowIndex:ce}))}o(ee,[{type:"UPDATE",fromRowIndex:L.row+1,toRowIndex:L.row+1+je}])}),Bt(0),A({col:Math.min((d=l==null?void 0:l.col)!=null?d:1/0,(p=s==null?void 0:s.min.col)!=null?p:1/0),row:Math.min((u=l==null?void 0:l.row)!=null?u:1/0,(C=s==null?void 0:s.min.row)!=null?C:1/0),doNotScrollX:!0,doNotScrollY:!0}),P({col:Math.max((I=l==null?void 0:l.col)!=null?I:0,(D=s==null?void 0:s.max.col)!=null?D:0),row:Math.max((S=l==null?void 0:l.row)!=null?S:0,(F=s==null?void 0:s.max.row)!=null?F:0)+je})}Lt(null)}Ye({columns:!1,rows:!1,active:!1})},[Xe,Ye,je,l,s==null?void 0:s.min,s==null?void 0:s.max,e,o,A,P,f,re]);fe("mouseup",jn);let Xn=(0,w.useCallback)(r=>{if(Xe!==null){let d=Ve(r);d&&(Bt(Math.max(0,d.row-Xe)),Ee({col:d.col,row:Math.max(d.row,Xe)}))}if(De.active){let d=Ve(r),p=f.length-(M?3:2);P(d&&{col:De.columns?Math.max(0,Math.min(p,d.col)):p,row:De.rows?Math.max(0,d.row):e.length-1,doNotScrollX:!De.columns,doNotScrollY:!De.rows}),j(!1)}},[Ee,De.active,De.columns,De.rows,Ve,f.length,M,P,e.length,Xe]);fe("mousemove",Xn);let Yn=(0,w.useCallback)(r=>{var d;if(l&&!r.isComposing){if(r.key==="Tab"&&!r.shiftKey&&l.col===f.length-(M?3:2)&&!f[l.col+1].disableKeys)if(l.row===e.length-1){if(We.current){r.preventDefault(),A(null),P(null),j(!1);let p=Rt(),u=p.indexOf(We.current);p[(u+1)%p.length].focus();return}}else{A(p=>{var u;return{col:0,row:((u=p==null?void 0:p.row)!=null?u:0)+1}}),P(null),j(!1),r.preventDefault();return}if(r.key==="Tab"&&r.shiftKey&&l.col===0&&!f[l.col+1].disableKeys)if(l.row===0){if(Ke.current){r.preventDefault(),A(null),P(null),j(!1);let p=Rt(),u=p.indexOf(Ke.current);p[(u-1+p.length)%p.length].focus();return}}else{A(p=>{var u;return{col:f.length-(M?3:2),row:((u=p==null?void 0:p.row)!=null?u:1)-1}}),P(null),j(!1),r.preventDefault();return}if((d=r.key)!=null&&d.startsWith("Arrow")||r.key==="Tab"){if(V&&f[l.col+1].disableKeys||V&&["ArrowLeft","ArrowRight"].includes(r.key))return;let p=([u,C],I)=>I&&{col:Math.max(0,Math.min(f.length-(M?3:2),I.col+u)),row:Math.max(0,Math.min(e.length-1,I.row+C))};if(r.key==="Tab"&&r.shiftKey)A(u=>p([-1,0],u)),P(null);else{let u={ArrowDown:[0,1],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowRight:[1,0],Tab:[1,0]}[r.key];(r.ctrlKey||r.metaKey)&&(u[0]*=f.length,u[1]*=e.length),r.shiftKey?P(C=>p(u,C||l)):(A(C=>p(u,C)),P(null))}j(!1),r.preventDefault()}else r.key==="Escape"?(!V&&!$&&A(null),P(null),j(!1)):(r.key==="Enter"||r.key==="F2")&&!r.ctrlKey&&!r.metaKey&&!r.altKey&&!r.shiftKey?(P(null),V?f[l.col+1].disableKeys||(bt(),r.preventDefault()):re(l)||(Q.current=l,j(!0),Ee(l),r.preventDefault())):r.key==="Enter"&&!r.ctrlKey&&!r.metaKey&&!r.altKey&&r.shiftKey?Ie((s==null?void 0:s.max.row)||l.row):r.key==="d"&&(r.ctrlKey||r.metaKey)&&!r.altKey&&!r.shiftKey?($e((s==null?void 0:s.min.row)||l.row,s==null?void 0:s.max.row),r.preventDefault()):(un(r.key)||r.code.match(/Key[A-Z]$/))&&!r.ctrlKey&&!r.metaKey&&!r.altKey?!V&&!re(l)&&(Q.current=l,P(null),j(!0),Ee(l)):["Backspace","Delete"].includes(r.key)?V||(dt(),r.preventDefault()):r.key==="a"&&(r.ctrlKey||r.metaKey)&&(V||(A({col:0,row:0,doNotScrollY:!0,doNotScrollX:!0}),P({col:f.length-(M?3:2),row:e.length-1,doNotScrollY:!0,doNotScrollX:!0}),r.preventDefault()))}},[l,f,e.length,dt,$e,V,Ie,re,Ee,s==null?void 0:s.max.row,s==null?void 0:s.min.row,$,A,P,bt,M]);fe("keydown",Yn);let $n=(0,w.useCallback)(r=>{var C;let d=((C=Me.current)==null?void 0:C.contains(r.target))||!1,p=d?Ve(r,!0,!0):null,u=p&&l&&l.col===p.col&&l.row===p.row&&V;d&&!u&&r.preventDefault()},[Ve,l,V]);fe("contextmenu",$n),(0,w.useEffect)(()=>{let r=[];(l==null?void 0:l.row)!==void 0&&r.push({type:"COPY",action:()=>{Qe(),ie(null)}},{type:"CUT",action:()=>{Ct(),ie(null)}},{type:"PASTE",action:()=>nt(null,null,function*(){if(navigator.clipboard.read!==void 0)(yield navigator.clipboard.read()).forEach(p=>nt(null,null,function*(){let u=[[""]];if(p.types.includes("text/html")){let C=yield p.getType("text/html");u=yt(yield C.text())}else if(p.types.includes("text/plain")){let C=yield p.getType("text/plain");u=rt(yield C.text())}else if(p.types.includes("text")){let C=yield p.getType("text");u=yt(yield C.text())}et(u)}));else if(navigator.clipboard.readText!==void 0){let d=yield navigator.clipboard.readText();et(rt(d))}else alert("This action is unavailable in your browser, but you can still use Ctrl+V for paste");ie(null)})}),(s==null?void 0:s.max.row)!==void 0?r.push({type:"INSERT_ROW_BELLOW",action:()=>{ie(null),Ie(s.max.row)}}):(l==null?void 0:l.row)!==void 0&&r.push({type:"INSERT_ROW_BELLOW",action:()=>{ie(null),Ie(l.row)}}),(s==null?void 0:s.min.row)!==void 0&&s.min.row!==s.max.row?r.push({type:"DUPLICATE_ROWS",fromRow:s.min.row+1,toRow:s.max.row+1,action:()=>{ie(null),$e(s.min.row,s.max.row)}}):(l==null?void 0:l.row)!==void 0&&r.push({type:"DUPLICATE_ROW",action:()=>{ie(null),$e(l.row)}}),(s==null?void 0:s.min.row)!==void 0&&s.min.row!==s.max.row?r.push({type:"DELETE_ROWS",fromRow:s.min.row+1,toRow:s.max.row+1,action:()=>{ie(null),ve(s.min.row,s.max.row)}}):(l==null?void 0:l.row)!==void 0&&r.push({type:"DELETE_ROW",action:()=>{ie(null),ve(l.row)}}),Kn(r),r.length||ie(null)},[s,l,ve,$e,Ie,Ct,Qe,et]);let Gt=(0,w.useRef)(Ue);Gt.current=Ue;let vn=(0,w.useCallback)(()=>Gt.current,[]);(0,w.useImperativeHandle)(Te,()=>({activeCell:Le(l,f),selection:Pt(s!=null?s:l?{min:l,max:l}:null,f),setSelection:r=>{let d=cn(r,f.length-(M?2:1),e.length,f);A((d==null?void 0:d.min)||null),j(!1),Ye({columns:!1,active:!1,rows:!1}),P((d==null?void 0:d.max)||null)},setActiveCell:r=>{let d=gt(r,f.length-(M?2:1),e.length,f);A(d),j(!1),Ye({columns:!1,active:!1,rows:!1}),P(null)}}));let Pe=(0,w.useRef)({onFocus:k,onBlur:me,onActiveCellChange:O,onSelectionChange:xe});return Pe.current.onFocus=k,Pe.current.onBlur=me,Pe.current.onActiveCellChange=O,Pe.current.onSelectionChange=xe,(0,w.useEffect)(()=>{Q.current&&(V?Pe.current.onFocus({cell:Le(Q.current,f)}):Pe.current.onBlur({cell:Le(Q.current,f)}))},[V,f]),(0,w.useEffect)(()=>{Pe.current.onActiveCellChange({cell:Le(l,f)})},[l==null?void 0:l.col,l==null?void 0:l.row,f]),(0,w.useEffect)(()=>{Pe.current.onSelectionChange({selection:Pt(s!=null?s:l?{min:l,max:l}:null,f)})},[(zt=s==null?void 0:s.min.col)!=null?zt:l==null?void 0:l.col,(_t=s==null?void 0:s.min.row)!=null?_t:l==null?void 0:l.row,(Ut=s==null?void 0:s.max.col)!=null?Ut:l==null?void 0:l.col,(jt=s==null?void 0:s.max.row)!=null?jt:l==null?void 0:l.row,l==null?void 0:l.col,l==null?void 0:l.row,f]),w.default.createElement("div",{className:t,style:n},w.default.createElement("div",{ref:Ke,tabIndex:i.length&&e.length?0:void 0,onFocus:r=>{r.target.blur(),A({col:0,row:0})}}),w.default.createElement(fn,{columns:f,outerRef:H,columnWidths:ae,hasStickyRightColumn:M,displayHeight:ze,data:e,fullWidth:Ze,headerRowHeight:m,activeCell:l,innerRef:Me,rowHeight:g,rowKey:E,selection:s,rowClassName:we,editing:V,getContextMenuItems:vn,setRowData:zn,deleteRows:ve,insertRowAfter:Ie,duplicateRows:$e,stopEditing:bt,cellClassName:J,onScroll:Ce},w.default.createElement(kt,{columnRights:de,columnWidths:ae,activeCell:l,selection:s,headerRowHeight:m,rowHeight:g,hasStickyRightColumn:M,dataLength:e.length,viewHeight:Se,viewWidth:ye,contentWidth:Ze?void 0:Gn,edges:mt,editing:V,isCellDisabled:re,expandSelection:Wn})),w.default.createElement("div",{ref:We,tabIndex:i.length&&e.length?0:void 0,onFocus:r=>{r.target.blur(),A({col:f.length-(M?3:2),row:e.length-1})}}),!b&&N&&w.default.createElement(N,{addRows:r=>Ie(e.length-1,r)}),_e&&Ue.length>0&&w.default.createElement(te,{clientX:_e.x,clientY:_e.y,cursorIndex:_e.cursorIndex,items:Ue,close:()=>ie(null)}))}));it.displayName="DataSheetGrid";var gn=require("react");var Vt=_(require("react"),1);var bn=Vt.default.forwardRef((q,Y)=>{var Z=q,{columns:e,gutterColumn:t,stickyRightColumn:n,addRowsComponent:a,createRow:o,duplicateRow:i,style:c,rowKey:m,onFocus:h,onBlur:x,onActiveCellChange:E,onSelectionChange:N,rowClassName:y,rowHeight:K}=Z,b=ft(Z,["columns","gutterColumn","stickyRightColumn","addRowsComponent","createRow","duplicateRow","style","rowKey","onFocus","onBlur","onActiveCellChange","onSelectionChange","rowClassName","rowHeight"]);let[te]=(0,gn.useState)({columns:e,gutterColumn:t,stickyRightColumn:n,addRowsComponent:a,createRow:o,duplicateRow:i,style:c,rowKey:m,onFocus:h,onBlur:x,onActiveCellChange:E,onSelectionChange:N,rowClassName:y,rowHeight:K});return Vt.default.createElement(it,se(X(X({},te),b),{rowHeight:typeof K=="number"?K:te.rowHeight,ref:Y}))});var be=_(require("react"),1),Sn=_(require("classnames"),1);var Cn=require("react"),Tn=()=>{let e=(0,Cn.useRef)(!0),t=e.current;return e.current=!1,t};var Dn=be.default.memo(({active:e,focus:t,rowData:n,setRowData:a,columnData:{placeholder:o,alignRight:i,formatInputOnFocus:c,formatBlurredInput:m,parseUserInput:h,continuousUpdates:x}})=>{let E=(0,be.useRef)(null),N=Tn(),y=(0,be.useRef)({rowData:n,formatInputOnFocus:c,formatBlurredInput:m,setRowData:a,parseUserInput:h,continuousUpdates:x,firstRender:N,focusedAt:0,changedAt:0,escPressed:!1});return y.current={rowData:n,formatInputOnFocus:c,formatBlurredInput:m,setRowData:a,parseUserInput:h,continuousUpdates:x,firstRender:N,focusedAt:y.current.focusedAt,changedAt:y.current.changedAt,escPressed:y.current.escPressed},(0,be.useLayoutEffect)(()=>{t?(E.current&&(E.current.value=y.current.formatInputOnFocus(y.current.rowData),E.current.focus(),E.current.select()),y.current.escPressed=!1,y.current.focusedAt=Date.now()):E.current&&(!y.current.escPressed&&!y.current.continuousUpdates&&!y.current.firstRender&&y.current.changedAt>=y.current.focusedAt&&y.current.setRowData(y.current.parseUserInput(E.current.value)),E.current.blur())},[t]),(0,be.useEffect)(()=>{!t&&E.current&&(E.current.value=y.current.formatBlurredInput(n))},[t,n]),be.default.createElement("input",{defaultValue:m(n),className:(0,Sn.default)("dsg-input",i&&"dsg-input-align-right"),placeholder:e?o:void 0,tabIndex:-1,ref:E,style:{pointerEvents:t?"auto":"none"},onChange:K=>{y.current.changedAt=Date.now(),x&&a(h(K.target.value))},onKeyDown:K=>{K.key==="Escape"&&(y.current.escPressed=!0)}})});Dn.displayName="TextComponent";var In=Ne();function Ne({placeholder:e,alignRight:t=!1,continuousUpdates:n=!0,deletedValue:a=null,parseUserInput:o=x=>x.trim()||null,formatBlurredInput:i=x=>String(x!=null?x:""),formatInputOnFocus:c=x=>String(x!=null?x:""),formatForCopy:m=x=>String(x!=null?x:""),parsePastedValue:h=x=>x.replace(/[\n\r]+/g," ").trim()||null}={}){return{component:Dn,columnData:{placeholder:e,alignRight:t,continuousUpdates:n,formatInputOnFocus:c,formatBlurredInput:i,parseUserInput:o},deleteValue:()=>a,copyValue:({rowData:x})=>m(x),pasteValue:({value:x})=>h(x),isCellEmpty:({rowData:x})=>x==null}}var Oe=_(require("react"),1),wr=["","false","no","off","disabled","0","n","f","unchecked","undefined","null","wrong","negative"],En=Oe.default.memo(({focus:e,rowData:t,setRowData:n,active:a,stopEditing:o,disabled:i})=>{let c=(0,Oe.useRef)(null);return(0,Oe.useLayoutEffect)(()=>{e&&(n(!t),o({nextRow:!1}))},[e,o]),Oe.default.createElement("input",{className:"dsg-checkbox",tabIndex:-1,type:"checkbox",ref:c,disabled:i,checked:!!t,onMouseDown:()=>!a&&n(!t),onChange:()=>null})});En.displayName="CheckboxComponent";var Nn={component:En,deleteValue:()=>!1,copyValue:({rowData:e})=>e?"YES":"NO",pasteValue:({value:e})=>!wr.includes(e.toLowerCase()),isCellEmpty:({rowData:e})=>!e};var Mn=Ne({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{let t=parseFloat(e);return isNaN(t)?null:t},parsePastedValue:e=>{let t=parseFloat(e);return isNaN(t)?null:t}});var Pn=Ne({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat().format(e):"",parseUserInput:e=>{let t=parseFloat(e);return isNaN(t)?null:Math.round(t)},parsePastedValue:e=>{let t=parseFloat(e);return isNaN(t)?null:Math.round(t)}});var yr=1e12,gr=1e10,Rn=Ne({alignRight:!0,formatBlurredInput:e=>typeof e=="number"?new Intl.NumberFormat(void 0,{style:"percent"}).format(e):"",formatInputOnFocus:e=>typeof e=="number"&&!isNaN(e)?String(Math.round(e*yr)/gr):"",parseUserInput:e=>{let t=parseFloat(e);return isNaN(t)?null:t/100},parsePastedValue:e=>{let t=parseFloat(e);return isNaN(t)?null:t}});var Fe=_(require("react"),1),An=_(require("classnames"),1),kn=Fe.default.memo(({focus:e,active:t,rowData:n,setRowData:a})=>{var i;let o=(0,Fe.useRef)(null);return(0,Fe.useLayoutEffect)(()=>{var c,m;e?(c=o.current)==null||c.select():(m=o.current)==null||m.blur()},[e]),Fe.default.createElement("input",{className:(0,An.default)("dsg-input",!t&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:o,style:{pointerEvents:e?"auto":"none",opacity:n||t?void 0:0},value:(i=n==null?void 0:n.toISOString().substr(0,10))!=null?i:"",onChange:c=>{let m=new Date(c.target.value);a(isNaN(m.getTime())?null:m)}})});kn.displayName="DateComponent";var Vn={component:kn,deleteValue:()=>null,copyValue:({rowData:e})=>e?e.toISOString().substr(0,10):null,pasteValue:({value:e})=>{let t=new Date(e.replace(/\.\s?|\//g,"-"));return isNaN(t.getTime())?null:t},minWidth:170,isCellEmpty:({rowData:e})=>!e};var Ge=_(require("react"),1),Bn=_(require("classnames"),1),Ln=Ge.default.memo(({focus:e,active:t,rowData:n,setRowData:a})=>{let o=(0,Ge.useRef)(null);return(0,Ge.useLayoutEffect)(()=>{var i,c;e?(i=o.current)==null||i.select():(c=o.current)==null||c.blur()},[e]),Ge.default.createElement("input",{className:(0,Bn.default)("dsg-input",!t&&"dsg-hide-date-picker"),type:"date",tabIndex:-1,max:"9999-12-31",ref:o,style:{pointerEvents:e?"auto":"none",opacity:n||t?void 0:0},value:n!=null?n:"",onChange:i=>{let c=new Date(i.target.value);a(isNaN(c.getTime())?null:c.toISOString().substr(0,10))}})});Ln.displayName="IsoDateComponent";var On={component:Ln,deleteValue:()=>null,copyValue:({rowData:e})=>e,pasteValue:({value:e})=>{let t=new Date(e.replace(/\.\s?|\//g,"-"));return isNaN(t.getTime())?null:t.toISOString().substr(0,10)},minWidth:170,isCellEmpty:({rowData:e})=>!e};var ke=_(require("react"),1);var br=i=>{var c=i,{columnData:{key:e,original:t},rowData:n,setRowData:a}=c,o=ft(c,["columnData","rowData","setRowData"]);let m=(0,ke.useRef)(n);m.current=n;let h=(0,ke.useCallback)(E=>{a(se(X({},m.current),{[e]:E}))},[e,a]);if(!t.component)return ke.default.createElement(ke.default.Fragment,null);let x=t.component;return ke.default.createElement(x,X({columnData:t.columnData,setRowData:h,rowData:n[e]},o))},Fn=(e,t)=>se(X({id:e},t),{columnData:{key:e,original:t},component:br,copyValue:({rowData:n,rowIndex:a})=>{var o,i;return(i=(o=t.copyValue)==null?void 0:o.call(t,{rowData:n[e],rowIndex:a}))!=null?i:null},deleteValue:({rowData:n,rowIndex:a})=>{var o,i;return se(X({},n),{[e]:(i=(o=t.deleteValue)==null?void 0:o.call(t,{rowData:n[e],rowIndex:a}))!=null?i:null})},pasteValue:({rowData:n,value:a,rowIndex:o})=>{var i,c;return se(X({},n),{[e]:(c=(i=t.pasteValue)==null?void 0:i.call(t,{rowData:n[e],value:a,rowIndex:o}))!=null?c:null})},disabled:typeof t.disabled=="function"?({rowData:n,rowIndex:a})=>{var o;return typeof t.disabled=="function"?t.disabled({rowData:n[e],rowIndex:a}):(o=t.disabled)!=null?o:!1}:t.disabled,cellClassName:typeof t.cellClassName=="function"?({rowData:n,rowIndex:a,columnId:o})=>{var i;return typeof t.cellClassName=="function"?t.cellClassName({rowData:n[e],rowIndex:a,columnId:o}):(i=t.cellClassName)!=null?i:void 0}:t.cellClassName,isCellEmpty:({rowData:n,rowIndex:a})=>{var o,i;return(i=(o=t.isCellEmpty)==null?void 0:o.call(t,{rowData:n[e],rowIndex:a}))!=null?i:!1}});var Cr=it,Tr=bn;0&&(module.exports={DataSheetGrid,DynamicDataSheetGrid,checkboxColumn,createAddRowsComponent,createContextMenuComponent,createTextColumn,dateColumn,floatColumn,intColumn,isoDateColumn,keyColumn,percentColumn,renderContextMenuItem,textColumn});
